"use strict";function addMdlToMenuItems(a){var b=document.querySelectorAll(a);if(!b)return!1;for(var c=0;c<b.length;c++){var d=b.item(c);d.classList.add("mdl-menu__item")}return!0}function modAdvancedSearchButton(a){var b=a.querySelector("#show_advanced");if(!b)return!1;b.classList.add("mdl-button","mdl-js-button","mdl-button--icon"),b.textContent="";var c=createIcon("expand_more");return b.appendChild(c),componentHandler.upgradeElement(b),!0}function modSearchButton(a){var b=a.querySelector("#searchinputbutton");if(!b)return!1;var c=document.createElement("label");c.classList.add("mdl-button","mdl-js-button","mdl-button--icon"),c.setAttribute("for","searchinputbutton");var d=createIcon("search");return c.appendChild(d),b.parentElement.appendChild(c),componentHandler.upgradeElement(b),!0}function createIcon(a){var b=document.createElement("i");return b.classList.add("material-icons"),b.textContent=a,b}function cloneNodeDiffTag(a,b){if(!a instanceof HTMLElement)return!1;for(var c=document.createElement(b),d=0;d<a.attributes.length;++d){var e=a.attributes.item(d).nodeName,f=a.attributes.item(d).nodeValue;c.setAttribute(e,f)}return c.innerHTML=a.innerHTML,a.parentElement.replaceChild(c,a),c}jQuery.fn.center=function(){return this.css("margin-left",($(window).width()-this.outerWidth())/2+$(window).scrollLeft()),this.addClass("JqueryCentered"),this},jQuery.fn.getCheckboxVal=function(){var a=[],b=0;return this.each(function(){a[b++]=jQuery(this).val()}),a},jQuery.fn.highlight=function(a){function b(a,c){var d=0;if(3==a.nodeType){var e=a.data.toUpperCase().indexOf(c);if(e>=0){var f=document.createElement("span");f.className="highlight";var g=a.splitText(e),h=(g.splitText(c.length),g.cloneNode(!0));f.appendChild(h),g.parentNode.replaceChild(f,g),d=1}}else if(1===a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName))for(var i=0;i<a.childNodes.length;++i)i+=b(a.childNodes[i],c);return d}return this.each(function(){b(this,a.toUpperCase())})},jQuery.fn.removeHighlight=function(){function a(b){for(var c=0,d=b.childNodes,e=d.length;e>c;c++){var f=d[c];if(1!=f.nodeType){if(3==f.nodeType){var g=f.nextSibling;if(null!==g&&3===g.nodeType){var h=f.nodeValue+g.nodeValue;new_node=b.ownerDocument.createTextNode(h),b.insertBefore(new_node,f),b.removeChild(f),b.removeChild(g),c--,e--}}}else a(f)}}return this.find("span.highlight").each(function(){var b=this.parentNode;b.replaceChild(this.firstChild,this),a(b)}).end()},jQuery.fn.isOnScreen=function(a){var b=$(window),c={top:b.scrollTop(),left:b.scrollLeft()};c.right=c.left+b.width(),c.bottom=c.top+b.height();var d=this.offset();return d.right=d.left+this.outerWidth(),d.bottom=d.top+this.outerHeight(),void 0===a?!(c.right<d.left||c.left>d.right||c.bottom<d.top||c.top>d.bottom):c.top<d.top&&c.bottom>d.bottom},jQuery.fn.zoom=function(a){$.fn.zoom.defaults={zoomWidth:5,zoomHeight:5,duration:150},a=$.extend($.fn.zoom.defaults,a);var b=this,c=0,d=0,e=1;return this.each(function(){c=$(this).height(),d=$(this).width(),e=$(this).css("opacity"),$(b).stop(!0,!1).animate({opacity:0,height:a.zoomHeight+"px",width:a.zoomWidth+"px",marginTop:(c-a.zoomHeight)/2+"px",marginLeft:(d-a.zoomWidth)/4+"px"},a.duration,"linear").animate({marginLeft:0,marginRight:0},100,"linear",function(){$(b).remove()})})},$(document).ajaxSend(function(a,b,c){function d(a){var b=null;if(document.cookie&&""!==document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}/^http:.*/.test(c.url)||/^https:.*/.test(c.url)||b.setRequestHeader("X-CSRFToken",d("csrftoken"))}).addClass("JS"),jQuery.fn.collapse=function(a){var b={closed:!1};return settings=jQuery.extend({},b,a),this.each(function(){$(this).find(".collapsible_icon").remove();var a=jQuery(this),b='<div class="collapsible_icon">';a.find("legend:first").unbind("click").addClass("collapsible").click(function(){jQuery(this).removeClass("collapsed"),a.children().not("legend").toggle("fast",function(){jQuery(this).is(":visible")?(a.removeClass("collapsed").addClass("collapsible"),a.find("legend:first").removeClass("collapsed").addClass("collapsible")):a.addClass("collapsed").find("legend").addClass("collapsed")})}).prepend(b),settings.closed?(a.addClass("collapsed").find("legend:first").addClass("collapsed"),a.children().not("legend:first").css("display","none")):(a.removeClass("collapsed").find("legend:first").removeClass("collapsed"),a.children().not("legend:first").show())})},jQuery.fn.editinplace=function(a){var b={};return settings=$.extend({},b,a),this.each(function(){var a=jQuery(this);return a.text(),$.fn.editinplace.addclick(a),a.addClass("editinplace_editable"),!1})},jQuery.fn.editinplace.addclick=function(a){return a.bind("click.editinplace",function(){var b=$(this).width();a.removeClass("editinplace_editable");var c=$("<div>").css({display:"flex","min-width":b+200+"px"}),d=$('<input type="submit" value="'+gettext("Save")+'" class="button editinplace mdl-button js-mdl-button js-mdl-button--ripple mdl-button--raised mdl-button--accent">').click(function(){var b=$(this).parent().find("input.editinplaceval").val();$.ajax({url:$(a).attr("rel"),data:{field_value:b},type:"POST",traditional:!0,success:function(){return $.growl(gettext("Saved title"),"success"),a.html(b).addClass("editinplace_editable"),$.fn.editinplace.addclick(a),!1},error:function(){return $.growl(gettext("Error updating title"),"error"),!1}})}).css({"margin-right":"16px"}),e=$('<input type="reset" value ="'+gettext("Cancel")+'" class="button editinplace mdl-button js-mdl-button js-mdl-button--ripple mdl-button--raised mdl-button--accent">').click(function(){return a.html($(this).data("original_value")).addClass("editinplace_editable"),$.fn.editinplace.addclick(a),$(this).parent().find(".editinplace").remove(),!1}).data("original_value",a.text()),f=$('<input class="editinplaceval mdl-textfield__input">').attr("value",a.text()).css({"line-height":"inherit",background:"transparent",color:"#fff","min-width":b-40+"px","border-bottom":"1px solid rgb(255,64,129)","margin-right":"16px",width:"auto"}).keydown(function(a){$(this).val($(this).val().replace(/\v+/g,"")),13===a.keyCode?($(this).unbind(),$(this).parent().find("input:submit").click(),a.preventDefault()):27===a.keyCode&&($(this).parent().find("input:reset").click(),a.preventDefault())});return $(c).append(f).append(d).append(e),a.unbind(".editinplace").html(c),f.focus(),!1}),!0},jQuery.fn.tablerowcheckbox=function(a){return this.each(function(){$("tbody tr",this).filter(":has(:checkbox:checked)").addClass("selected").end().on("click",function(b){$(this).find(":has(:checkbox)").length>0&&$(this).toggleClass("selected"),"checkbox"!==b.target.type&&"radio"!==b.target.type&&($(":checkbox",this).attr("checked",function(){return!this.checked}).trigger("change"),$(":radio",this).attr("checked","checked").trigger("change"),$.isFunction(a)&&a.call(this))})})},jQuery.extend(jQuery.easing,{easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?7.5625*d*b*b+c:2/2.75>b?d*(7.5625*(b-=1.5/2.75)*b+parseFloat(".974375"))+c:2.5/2.75>b?d*(7.5625*(b-=2.25/2.75)*b+parseFloat(".994375"))+c:d*(7.5625*(b-=2.625/2.75)*b+parseFloat(".984375"))+c}}),function(a){function b(b){if("string"==typeof b.data){var c=b.handler,d=b.data.toLowerCase().split(" ");b.handler=function(b){if(this===b.target||!/textarea|select/i.test(b.target.nodeName)&&"text"!==b.target.type){var e="keypress"!==b.type&&a.hotkeys.specialKeys[b.which],f=String.fromCharCode(b.which).toLowerCase(),g="",h={};b.altKey&&"alt"!==e&&(g+="alt+"),b.ctrlKey&&"ctrl"!==e&&(g+="ctrl+"),b.metaKey&&!b.ctrlKey&&"meta"!==e&&(g+="meta+"),b.shiftKey&&"shift"!==e&&(g+="shift+"),e?h[g+e]=!0:(h[g+f]=!0,h[g+a.hotkeys.shiftNums[f]]=!0,"shift+"===g&&(h[a.hotkeys.shiftNums[f]]=!0));for(var i=0,j=d.length;j>i;i++)if(h[d[i]])return c.apply(this,arguments)}}}}a.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},a.each(["keydown","keyup","keypress"],function(){a.event.special[this]={add:b}})}(jQuery),!function(a){a.RelatedCollection=Backbone.Collection.extend({model:cntmo.vs.VSItem||Backbone.Models,parse:function(a){return a.objects},initialize:function(a,b){b||(b={}),this.url=b.url}}),a.ACLCollection=Backbone.Collection.extend({model:cntmo.prtl.Item.ACL,initialize:function(a,b){b||(b={}),this.url=b.url}}),a.ShapeCollection=Backbone.Collection.extend({model:cntmo.prtl.Item.Shape,initialize:function(a,b){b||(b={}),this.url=b.url}}),a.JobCollection=Backbone.Collection.extend({model:cntmo.prtl.Item.JobItem,initialize:function(a,b){b||(b={}),this.url=b.url}})}(cntmo.prtl.Item=cntmo.prtl.Item||{},jQuery),$(function(){selectAllItems=function(a){a&&(a.stopPropagation(),a.preventDefault()),$(".mediaitem").click()},deselectAllItems=function(a){a&&(a.stopPropagation(),a.preventDefault()),$(".infocheckbox:checked").parents(".mediaitem").click()},selectAllUnselectedItems=function(a){a&&(a.stopPropagation(),a.preventDefault()),$(".mediaitem").each(function(){$(this).hasClass("mediaitem-selected")||$(this).click()})},$(document).on("mouseenter mouseleave",".mediaitem",function(){$(this).addClass("mediaitem-active")},function(){$(this).removeClass("mediaitem-active")}),$(document).on("click",".mediaitem",function(a){$("#searchinputfield").blur();var b,c=$(this).find("input");if(c.is(":checked")?($(this).trigger("unselectitem"),b="unselectitem"):(b="selectitem",$(this).trigger("selectitem")),a.shiftKey&&void 0!==cntmo.app.page.lastMediaItemClicked){var d="#"+cntmo.app.page.lastMediaItemClicked;0!==$(this).prevAll(d).length?$(this).prevUntil(d).trigger(b):0!==$(this).nextAll(d).length&&$(this).nextUntil(d).trigger(b)}cntmo.app.page.lastMediaItemClicked=$(this).attr("id")}),$(document).on("selectitem",".mediaitem",function(){$(this).addClass("mediaitem-selected");var a=$(this).find("input");a.is(":checked")||a.prop("checked",!0),$(this).trigger("updatecount")}),$(document).on("unselectitem",".mediaitem",function(){$(this).removeClass("mediaitem-selected");var a=$(this).find("input");a.is(":checked")&&a.prop("checked",!1),$(this).trigger("updatecount")}),$(".mediaitem").draggable("destroy").draggable({delay:100,helper:"clone",revert:!0,zIndex:100,distance:25,revertDuration:50}),$(document).on("click",".podmenu_holder a.add_to_collection",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parents(".mediaitem").attr("id");$LAB.script(cntmo.loadLocations.addToCollection).wait(function(){new cntmo.prtl.Collection.addToCollection({collectionaddbuttontext:gettext("Add To Collection"),collectioncancelbuttontext:gettext("Cancel"),title:gettext("Add Item to Collection"),selected_objects:[b],library_selected:void 0,ignore_list:[]})})}),$(document).on("click",".podmenu_holder a.deleteitem",function(a){$(this).parents(".mediaitem").trigger("click"),deleteItems(a)}),$(document).on("click","a.mdl-menu__item.add_to_bin",function(a){var b=$(this).parents(".mediaitem"),c=[];if(cntmo.app.page.mediaBinItems.isInBin(b.attr("id"))===!1)try{cntmo.app.page.mediaBinItems.create({resource_id:b.attr("id"),resource_name:b.find(".mdl-card__title .mdl-card__title-text").html(),thumbnail_uri:b.find("img.mediathumb").attr("src"),resource_type:b.data("itemtype")},{error:function(){c.push(gettext("Could not add item to bin"))}})}catch(a){c.push(a)}else c.push(gettext("Item already in MediaBin"));if(c.length>0){var d="";_.each(c,function(a){d!=a&&($.growl(a),d=a)})}else $.publish("/cntmo/prtl/MediaBin/finishedAdding"),$.growl(gettext("Added to MediaBin"),"success");$(this).trigger("updatecount")}),$(document).on("click",".smallgriditem",function(){$(this).toggleClass("smallgriditem-selected").find(".smallgriditem-plus").toggleClass("smallgriditem-plus-selected"),$(this).removeClass("mediaitem-active").find(".smallgriditem-plus").removeClass("smallgriditem-plus-active"),$(this).hasClass("smallgriditem-selected")||($(this).find(".sitdd-multi").hide(),$(this).find(".sitdd-single").show()),input=$(this).find("input"),input.attr("checked")?input.attr("checked",!1):input.attr("checked",!0),$(this).trigger("updatecount")}),$(".mediabox-deleteslctd").click(function(a){a.preventDefault(),a.stopPropagation();var b=[];$.each($(".mediabox-selected"),function(a,c){b.push(c.id)}),$.ajax({type:"POST",url:url_delete_items,traditional:!0,data:{selected_objects:b},success:function(){$.each(b,function(a,b){$("#"+b).remove()}),$.growl(gettext("Successfully deleted"),"success")},error:function(){$.growl(gettext("Failed to delete"),"error")}})}),$(document).on("click","#mediabox-selectall",function(){var a=$(this).find("input");a.attr("checked",!0),$(".mediabox").addClass("mediabox-selected").find(".mediabox-plus").addClass("mediabox-plus-selected")}),$(document).on("click","#mediabox-deselectall",function(){var a=$(this).find("input");a.attr("checked",!1),$(".mediabox").removeClass("mediabox-selected").find(".mediabox-plus").removeClass("mediabox-plus-selected")})}),!function(a,b,c){a.Item=Backbone.Model.extend({defaults:{ui_selected:!1,resource_uri:"",absolute_url:"",resource_type:"",thumbnail_uri:"",parent_id:"",name:"",user:""},url:function(){return this.get("resource_uri")||this.collection.url},toggle:function(){this.set({ui_selected:!this.get("ui_selected")})},clear:function(){var a=this;this.destroy({success:function(){a.view.remove()},error:function(a,c){b.growl(c.responseText,"error")},wait:!0})},parse:function(a){return(""===a.absolute_url||a.absolute_url===c)&&(a.absolute_url="/vs/item/",a.absolute_url+=a.resource_id!==c?a.resource_id+"/":a.id+"/"),a}}),a.JobItem=Backbone.Model.extend({}),a.Shape=Backbone.Model.extend({defaults:{id:"",name:"",filename:"",filesize:"",json_object:"",format:"",download_uri:""},url:function(){return""!==this.id?this.collection.url+this.id+"/":this.collection.url},clear:function(){var a=this;this.destroy({success:function(){a.view.remove()},error:function(a,c){b.growl(c.responseText,"error")}})}}),a.ACL=Backbone.Model.extend({defaults:{id:"",user:"",group:"",permission:"",recursive:""},url:function(){return""!==this.id?this.collection.url+this.id+"/":this.collection.url},clear:function(){var a=this;this.destroy({success:function(){a.view.remove()},error:function(a,c){b.growl(c.responseText,"error")}})}})}(cntmo.prtl.Item=cntmo.prtl.Item||{},jQuery),cntmo.vs.VSItem=cntmo.prtl.Item.Item,cntmo.vs.VSSequence=cntmo.vs.VSItem.extend({initialize:function(){}}),!function(a,b,c){a.NewView=Backbone.View.extend({events:{"click #submit":"submit","submit form":"submitFormHandler"},initialize:function(a){_.bindAll(this,"render","changeform","beforeSubmit"),this.options=a||{},this.form=c,this.submit_template=a.submit_template||"",this.advanced_template=a.advanced_template||"",this.change_form_id=a.change_form_id||c,this.collectionselect_field_id=a.collectionselect_field_id||c,this.setupForm(gblDefaultMetadataGroup)},setupForm:function(a){return this.form=cntmo.app.page.forms[_.uniqueId("form")]=new cntmo.prtl.Metadata.Form({metadataGroup:a,el:this.options.formel}),this.form},render:function(){if(this.form){if(this.submit_template!==c&&(this.$submit_template=b(_.template(this.submit_template)()),this.form.$fieldset.after(this.$submit_template)),""!==this.advance_template&&(this.$advanced=b(_.template(this.advanced_template)()),this.form.$fieldset.after(this.$advanced),this.$advanced.collapse({closed:!0})),this.change_form_id!==c){var a="change "+this.change_form_id;this.events[a]="changeform",this.delegateEvents()}this.collectionselect_field_id!==c&&b(this.collectionselect_field_id).AjaxCollectionSelect()}return this},changeform:function(a){var c=b(a.currentTarget).val();this.form.changeFormMetadataGroup(c)},beforeSubmit:function(a){return a=this.form.serialize(!0),!0},submit:function(a){var c=this;return a.preventDefault(),this.form.valid()?(this.form.$el.ajaxForm({type:"post",contentType:"application/json; charset=utf-8",accepts:{json:"application/json",text:"text/plain"},dataType:"json",beforeSubmit:c.beforeSubmit,error:function(){b.growl(gettext("There was an error sending this form"),"error")}}),this.form.$el.submit()):b.growl(gettext("There was an error with the form, please check all the fields"),"error"),!0},submitFormHandler:function(){return!0}})}(cntmo.prtl.Item=cntmo.prtl.Item||{},jQuery),cntmo.prtl.ViewClass=Backbone.View.extend({render:function(){return this},hide:function(a){return this.$el.hide(a),this.$el.addClass("hidden"),this},show:function(a,b){return this.isHidden===!0?this.render():(void 0===b||b===!0)&&this.render(),this.$el.show(a),this.$el.removeClass("hidden"),this},isHidden:function(){return this.$el.hasClass("hidden")}}),cntmo.prtl.ViewClassLoad=cntmo.prtl.ViewClass.extend({initialize:function(a){void 0===this.options&&(this.options=a||{}),this.viewurl=this.options.url,_.bindAll(this,"render"),this.bind("render",this.render)},render:function(){return this.$el.load(this.viewurl),this.$el.html(""),this}}),cntmo.prtl.views.ShapeManage=Backbone.View.extend({events:function(){var a={"click .manage":"openManageDialog"};return a},initialize:function(a){_.bindAll(this,"openManageDialog"),this.remote_url=$(a.el.target).attr("href"),this.title=$(a.el.target).data("shape-name"),this.openManageDialog()},openManageDialog:function(){var a=this;a.$manageDialog=$("<div></div>"),a.$manageDialog.load(this.remote_url).dialog({width:"80vw",modal:!0,resizable:!1,dialogClass:"exportView",title:this.title,show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},close:function(){$(this).dialog("destroy").remove(),cntmo.prtl.panelviews.MediaItemFormatsPanel.timedGet()},buttons:[{text:gettext("Close"),click:function(){$(".ui-dialog-content").dialog("close")},class:"cancel-export-button ui-dialog-button-cancel"}]})},render:function(){return this},close:function(){void 0!==this.$manageDialog&&this.$manageDialog.dialog("close")}}),function(a,b,c){a.MediaViewRouter=Backbone.Router.extend({initialize:function(a){this.options=a||{},this.parentView=a.parentView},routes:{"comments/c:id":"viewcomments"},viewcomments:function(a){b("nav.mi_contextmenu a").find("selected").removeClass("selected"),b("a#mv_comments_a").panelMgr({contextMenu:"li",el:event.target,panelName:"mv_panel"}).addClass("selected"),setTimeout(function(){b(window).scrollTop(b("#comment"+a).offset().top)},1e3)},clickPanel:function(){b("#mv_posters_a").click(),this.parentView.$el.find("#"+Backbone.history.fragment).click()}}),a.MediaViewPage=Backbone.View.extend({events:{"click .disabled a":"disableHandler","click #mi_contextmenu a":"clickPanelMenu","click .add_to_collection":"addToCollection","click .make_latest_version":"makeLatestVersion","click .clone_item":"cloneItem","click .upload_item_version":"uploadItemVersion","click #delete_metadata":"clickDeleteMetadata","click #exportitem":"exportItem","click #returntoplaceholder":"returnToPlaceHolder","click #archive_item":"archiveItem","click #restore_item":"restoreItem","click a#transcodeitem":"transcodeItem","click a#relateitem":"relateItem","click a.add_to_bin":"addToBin","click a.share_item":"shareItem"},initialize:function(d){this.options=d||{},this.model=d.model,this.definedurls=d.definedurls||{},this.panels=d.panels,this.message_strings=d.message_strings,this.router=new a.MediaViewRouter({parentView:this}),this.initializePanelRouters(),d.initializePanels===!0&&this.model!==c&&this.initializePanels(),this.views={},b(".title_editable").editinplace();var e=this,f=b(cntmo.app.players.mainPlayer);if(f.on("grabStill",function(a,b){e.grabStill(a,b)}),cntmo.app.players!==c&&cntmo.app.players.mainPlayer!==c){var g={};location.search.substr(1).split("&").forEach(function(a){g[a.split("=")[0]]=a.split("=")[1]}),g.hasOwnProperty("startTimecode")&&b(cntmo.app.players.mainPlayer.timeline.currentClip().video).on("canplay",function(){cntmo.app.players.mainPlayer.setCurrentTC(new Timecode({smpte:g.startTimecode}))})}Backbone.history.start({root:this.definedurls.this})},initializePanels:function(){cntmo.prtl.panelviews=this.panels},initializePanelRouters:function(){var a=this;a.$el.find("#mi_contextmenu a").each(function(c,d){b(d).is("[shortcut]")||b(d).attr("shortcut","shortcut"+b(d).attr("id")),a.router.route(b(d).attr("shortcut"),function(){b(document).ready(function(){a.$el.find("#mi_contextmenu").find('[shortcut="'+Backbone.history.fragment+'"]').click()})})})},disableHandler:function(a){return a.preventDefault(),a.stopImmediatePropagation(),!1},clickPanelMenu:function(a){return b(a.target).panelMgr({contextMenu:"li",el:a.target,panelName:"mv_panel"}),b(a.target).is("[shortcut]")?this.router.navigate(b(a.target).attr("shortcut"),{trigger:!1,replace:!0}):this.router.navigate(b(a.target).attr("id"),{trigger:!1,replace:!0}),!1},addToBin:function(a){a.preventDefault();var c=this;if(0==cntmo.app.page.mediaBinItems.isInBin(c.model.get("id")))try{cntmo.app.page.mediaBinItems.create({resource_id:c.model.get("id"),resource_name:c.model.get("resource_name"),resource_type:c.model.get("resource_type"),thumbnail_uri:c.model.get("thumbnail_uri")},{success:function(){b.publish("/cntmo/prtl/MediaBin/finishedAdding")},error:function(){b.growl(gettext("Could not add item to bin"),"error")}})}catch(a){alert(a)}else b.growl(gettext("Item is already in MediaBin"),"error")},shareItem:function(a){a.preventDefault();var b=this;cntmo.prtl.Sharing.share(b.model.get("id"),{definedurls:b.definedurls})},grabStill:function(a,c){a.preventDefault();var d=c.toSMPTE(),e=this;b.ajax({url:e.definedurls.grabstill,data:{smptetimecode:d},type:"POST",success:function(a){b.growl(a.message,"success")},error:function(a){b.growl(a.data,"error")}})},transcodeItem:function(a){a.preventDefault(),this.definedurls.transcodeurl!==c&&b("#transcodepanel").load(this.definedurls.transcodeurl)},relateItem:function(a){a.preventDefault();var c=this;this.$el.find("#relateholder").load(c.definedurls.searchajax),b(".mediaitemgridmini").live("click",function(){b(this).toggleClass("mediaitem-selected");var a=b(this).attr("id");b("#searchresultschoices").html('<button id="makerelation" class="button">Make relation</button>'),b("#makerelation").live("click",function(d){d.preventDefault(),b.ajax({url:c.definedurls.createitemrelationship,data:{source:c.model.get("id"),target:a},type:"GET",success:function(){0==item_has_relations&&(b("#relationstbl tbody").append('<tr class="heading"><th></th><th>Item</th><th>Direction</th><th>Item</th></tr>'),b("#no_relations_text").remove(),item_has_relations=!0),b("#relationstbl tr:last").after('<tr><td></td><td>{{ item.getId }}</td><td>U</td><td><a href="/vs/item/'+a+'/">'+a+"</a></td></tr>")}})})})},returnToPlaceHolder:function(a){a.preventDefault(),confirm(gettext("Are you sure that you want to turn this item back into a placeholder. Files will not be deleted"))&&b.ajax({url:this.definedurls.returntoplaceholderurl,type:"DELETE",success:function(){confirm(gettext("Turning back to placeholder was successful, do you want to reload the current page?"))&&document.location.reload(!0)},error:function(a){b.growl(a.responseText)}})},exportItem:function(a){if(a.preventDefault(),!b(a.target).data("disabled")){var c=this,d={width:600,modal:!0,resizable:!1,dialogClass:"exportView",title:gettext("Export"),show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},close:function(){b(this).dialog("destroy").remove()},buttons:[{text:gettext("Export"),click:function(){b("#export_ajax_form").submit()},class:"send-export-button ui-dialog-button-confirm"},{text:gettext("Cancel"),click:function(){b(".ui-dialog-content").dialog("close")},class:"cancel-export-button ui-dialog-button-cancel"}]};c.$dialogEl=b("<div></div>"),c.$dialogEl.load(c.definedurls.exporturl).dialog(d),c.$dialogEl.on("change",".ftpuri",function(a){val=b(a.currentTarget).val();var c=b(a.currentTarget).find("option[value='"+val+"']").attr("filename_override");"true"===c?b(a.currentTarget).parents("form").find(".exportfilenamediv").show():b(a.currentTarget).parents("form").find(".exportfilenamediv").hide()})}},archiveItem:function(a){a.preventDefault(),itemId=b("#archive_item").attr("ref"),b.ajax({type:"POST",url:"/archive_framework/"+itemId+"/archive/",success:function(){b.growl(gettext("Item queued for archival"),"success")},error:function(a){b.growl(a.responseText,"error")}})},restoreItem:function(a){a.preventDefault(),itemId=b("#restore_item").attr("ref"),b.ajax({type:"POST",url:"/archive_framework/"+itemId+"/restore/",success:function(){b.growl(gettext("Item queued for restore"),"success")},error:function(a){b.growl(a.responseText,"error")}})},uploadItemVersion:function(a){a.preventDefault();var c=this,d={width:600,modal:!0,resizable:!1,dialogClass:"uploadView",title:gettext("Upload new version"),show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},close:function(){b(this).dialog("destroy").remove()},buttons:[{text:gettext("Upload"),click:function(){b(".plupload_start").click();var a=b(this).dialog("option","buttons",[]),c=b("#uploader").pluploadQueue();c.bind("UploadComplete",function(){a.dialog("option","buttons",[{text:gettext("Done"),class:"send-export-button ui-dialog-button-confirm",click:function(){b(".ui-dialog-content").dialog("close")}}])})},class:"send-export-button ui-dialog-button-confirm"},{text:gettext("Cancel"),click:function(){b(".ui-dialog-content").dialog("close")},class:"cancel-export-button ui-dialog-button-cancel"}]};c.$dialogEl=b("<div></div>"),c.$dialogEl.load(c.definedurls.uploaditem).dialog(d)},addToCollection:function(a){var b=this,d=b.model.id;a.preventDefault(),a.stopPropagation(),$LAB.script(cntmo.loadLocations.addToCollection).wait(function(){new cntmo.prtl.Collection.addToCollection({collectionaddbuttontext:gettext("Add To Collection"),collectioncancelbuttontext:gettext("Cancel"),title:gettext("Add To Collection"),selected_objects:[d],library_selected:c,ignore_list:[]})})},clickDeleteMetadata:function(a){a.preventDefault(),confirm(gettext("Do you really want to remove the metadata group from this item?"))&&(document.location.href=this.definedurls.removemetadataurl)},makeLatestVersion:function(a){a.preventDefault();var d=this,e={width:600,modal:!0,resizable:!1,dialogClass:"makeLatestVersionView",title:gettext("Make into latest version"),show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},close:function(){b(this).dialog("destroy").remove()},buttons:[{text:gettext("Submit"),click:function(){b("#make_latest_ajax_form").submit(),b(".ui-dialog-content").dialog("close")},class:"send-export-button ui-dialog-button-confirm"},{text:gettext("Cancel"),click:function(){b(".ui-dialog-content").dialog("close")},class:"cancel-export-button ui-dialog-button-cancel"}]};d.$dialogEl=b("<div></div>");var f;try{f=b(a.currentTarget).attr("href")}catch(a){f=d.definedurls.makelatestversionurl}(f===c||""===f)&&(f=d.definedurls.makelatestversionurl),d.$dialogEl.load(f).dialog(e)},cloneItem:function(a){a.preventDefault();var c=this,d={width:600,modal:!0,resizable:!1,dialogClass:"cloneItemView",title:gettext("Clone to new item"),show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},close:function(){b(this).dialog("destroy").remove()},buttons:[{text:gettext("Clone"),click:function(){b("#clone_ajax_form").submit()},class:"send-export-button ui-dialog-button-confirm"},{text:gettext("Cancel"),click:function(){b(".ui-dialog-content").dialog("close")},class:"cancel-export-button ui-dialog-button-cancel"}]};c.$dialogEl=b("<div></div>"),c.$dialogEl.load(c.definedurls.cloneitemurl).dialog(d)}}),a.MediaItemThumbnailPanel=cntmo.prtl.ViewClassLoad.extend({render:function(){return this.constructor.__super__.render.call(this),this.$el.css("display","flex"),this}}),a.MediaItemPreviewPanel=cntmo.prtl.ViewClass.extend({initialize:function(){this.constructor.__super__.initialize.call(this),this.adjustDisplay()},render:function(){return this.constructor.__super__.render.call(this),this},show:function(){return this.constructor.__super__.show.call(this),this.adjustDisplay(),this},hide:function(){return this.constructor.__super__.hide.call(this),this.$el.parent().removeAttr("style"),this},adjustDisplay:function(){this.$el.css("display","flex"),this.$el.parent().css("padding","0")}}),a.MediaItemPosterPanel=cntmo.prtl.ViewClassLoad.extend({render:function(){return this.constructor.__super__.render.call(this),this.$el.css("display","flex"),this}}),a.MediaItemMetadataPanel=cntmo.prtl.ViewClass.extend(),a.MediaItemVersionsPanel=cntmo.prtl.ViewClass.extend({el:"div",initialize:function(a){this.options=a||{},this.collection=new Backbone.Collection([],{url:this.options.url}),_.bindAll(this,"render","closeViewPanel"),this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll),this.bind("render",this.render),this.$el=b("#versions-menu"),this.url=a.url||"versions/",this.currentSelectedVersion=a.currentSelectedVersion||""},render:function(){var a=this,c=a.url;a.$el.removeClass("hidden").show(),a.$el.find("container").html(""),b("#mi_contextmenu").on("click","a",function(){a.closeViewPanel()}),""!==a.currentSelectedVersion&&(c+="?currentSelectedVersion="+a.currentSelectedVersion),b.ajax(c,{beforeSend:function(){b(".loading-icon").show(),b("#media-info-card").hide()},success:function(c){b(".loading-icon").hide(),a.$el.find(".versions").html(c),a.$el.show()},error:function(){b.growl("There was an error loading up versions","error"),b(".loading-icon").hide(),a.$el.find(".versions").html("")}})},closeViewPanel:function(){return b("#mi_contextmenu").off("click","a"),b("#media-info-card").show(),!0}}),a.MediaItemFormatsPanel=cntmo.prtl.ViewClass.extend({initialize:function(a){this.options=a||{},this.collection=new cntmo.prtl.Item.ShapeCollection([],{url:this.options.url}),_.bindAll(this,"addOne","addAll","render"),this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll),this.bind("render",this.render)},render:function(){return this.collection.fetch({success:function(){this.$("td.imgpreloader").hide()}}),this},addOne:function(a){var b=new cntmo.prtl.Item.ShapeView({model:a});this.$("#cntmo_prtl_mediaitem_shape_table").append(b.render().el)},addAll:function(){var a=this,b=a.$("#cntmo_prtl_mediaitem_shape_table").find(".imgpreloader");b.parent().siblings().remove(),b.hide(),this.collection.where({filesize:""}).length>0||this.collection.where({filesize:"-1 bytes"}).length>0?a.timer===c&&a.timedGet():a.timer!==c&&a.clearTimer(),this.collection.each(this.addOne)},clearTimer:function(){clearInterval(this.timer)},timedGet:function(){var a=this;a.timer!==c&&a.clearTimer(),a.timer=setInterval(function(){a.collection.fetch({success:function(){a.addAll()}})},5e3)}}),a.MediaItemRelatedPanel=cntmo.prtl.ViewClassLoad.extend({render:function(){var a=this;return b.ajax({url:this.options.url,beforeSend:function(){a.loadingicon=b('<div class="loading" style="margin: 20px auto;font-weight:700;width: 200px; text-align:center;">').html(b(".loading-icon").html()),a.$el.find(".related_wrapper").html(a.loadingicon)},error:function(c){a.$el.find(".related_wrapper").html(""),b.growl(c.data,"error")},success:function(b){a.$el.find(".related_wrapper").html(b).find(".relatedpanelcontent").accordion({collapsible:!0,active:!1})}}),this}}),a.MediaItemHistoryPanel=cntmo.prtl.ViewClass.extend({initialize:function(a){this.options=a||{},this.collection=new cntmo.prtl.Item.JobCollection([],{url:this.options.url}),_.bindAll(this,"addOne","addAll","render"),
this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll),this.bind("render",this.render)},render:function(){return this.collection.fetch({reset:!0,success:function(){this.$("td.imgpreloader").hide()}}),this},addOne:function(a){var b=new cntmo.prtl.Item.HistoryView({model:a});this.$("#jobstbl").append(b.render().el)},addAll:function(){this.$("#jobstbl tbody").html(""),this.collection.each(this.addOne)}}),a.MediaItemACLPanel=cntmo.prtl.ViewClass.extend({events:{"click #aclmanage":"loadacladd","click #addpermbut":"addNewACL","click #showhideaudit":"showAudit"},initialize:function(a){this.options=a||{},this.collection=new cntmo.prtl.Item.ACLCollection([],{url:this.options.url}),_.bindAll(this,"addOne","addAll","render"),this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll)},render:function(){return this.collection.fetch({success:function(){this.$("td.imgpreloader").hide()}}),this.auditshowing=!1,this.$("#aclmanage").show(),this},addOne:function(a){var b=new cntmo.prtl.Item.ACLView({model:a});this.$("#access_rights tbody").append(b.render().el)},addAll:function(){this.$("#access_rights tbody").html(""),this.collection.each(this.addOne)},loadacladd:function(a){var c=this;0==c.$("#access_rights tfoot").find(".inlineACLEditor").length&&b.get(b(a.currentTarget).attr("rel"),function(a){c.$("#access_rights tfoot").append(a)})},showAudit:function(a){var c=this,d=c.$("#showhideaudit").attr("before"),e=c.$("#showhideaudit").attr("after");c.auditshowing===!1?(c.auditshowing=!0,b.get(b(a.currentTarget).attr("rel"),function(a){c.$("#aclmanage").fadeOut("fast"),c.$("table#access_rights").fadeOut(250,function(){c.$("table#audit_access_rights").find("tbody").html(a),c.$("table#audit_access_rights").fadeIn(250)}),c.$("#showhideaudit").find("button").html(e)})):(c.auditshowing=!1,c.$("table#audit_access_rights").fadeOut(250,function(){c.$("table#access_rights").fadeIn(500),c.render(),c.$("#aclmanage").fadeIn("fast")}),c.$("table#audit_access_rights").hide(),c.$("#showhideaudit").find("button").html(d))},addNewACL:function(){var a=this.$("#id_recipient").val();perm=this.$("#id_permission").val(),user="",group="","user_"==a.substr(0,5)?user=a.slice(5):group=a.slice(6),this.collection.create({user:user,group:group,permission:perm},{error:function(){b.growl(gettext("Could not add item"),"error")}})}}),a.MediaItemCommentsPanel=cntmo.prtl.ViewClass.extend({tagName:"div",events:{"click .submit-post":"submitForm","click .replyToComment":"replyToComment","click .deleteComment":"deleteComment","click .commentEditable":"editComment"},initialize:function(a){this.options=a||{},_.bindAll(this,"render","submitForm","replyToComment")},render:function(){var a;return a=this.options.share!==c?this.options.url+"?asset_id="+this.options.share.asset_id+"&email_address="+this.options.share.email_address+"&unique_key="+this.options.share.unique_key:this.options.url,this.$el.find(".comments_wrapper").load(a),this},submitForm:function(a){a.preventDefault(a);var c=this;return this.$el.find("#commentsCommentForm").ajaxSubmit({dataType:"json",success:function(){c.render(),b(".commentsCommentCount").length>0&&b.ajax({url:c.options.url+"?count",dataType:"json",type:"GET",success:function(a){b(".commentsCommentCount").html("("+a.count+")")}})},error:function(a,b,d){var e="";try{e=JSON.parse(a.responseText).detail}catch(b){JSON.parse(a.responseText).detail,e=d}c.$el.find(".commentsCommentError").addClass("errormessage").html("<p>"+e+"</p>")}}),this},fullDeleteComment:function(a){a.preventDefault(a);var c="",d=b(a.target);b.ajax({url:"/comments/comment/"+d.attr("rel"),type:"DELETE",dataType:"json",success:function(){b("#comment"+d.attr("rel")).fadeOut().remove();var a=b(".comment").length-1;a>0&&(c="("+a+")"),b(".commentsCommentCount").html(c)},error:function(a){b.growl(a.data,"error")}})},editComment:function(a){a.preventDefault(a);var d,e,f,g,h=this,i=b(a.target),j=i.html();console.log(i),i.hasClass("commentEditable")&&i.find("textarea.commentEditing").length<1&&(g=b("<textarea>").html(j),f=b('<div class="buttonWrapper">'),d=b('<input type="reset" class="comment-canceledit" value="'+gettext("Cancel")+'">').on("click",function(a){a.preventDefault(),i.html(j)}),e=b('<input type="submit" class"comment-update" value="'+gettext("Update")+'">').on("click",function(a){a.preventDefault();var d={comment:g.val()};h.options.share!==c&&(d.share=h.options.share),b.ajax({url:"/comments/comment/"+i.attr("rel")+"/",type:"PATCH",data:JSON.stringify(d),dataType:"json",contentType:"application/json",success:function(){h.render()},error:function(a,c,d){var e;try{e=JSON.parse(a.responseText).detail}catch(b){JSON.parse(a.responseText).detail,e=d}b.growl(e,"error")}}),b(this).off()}),g.addClass("commentEditing"),f.append(e,d),i.html(g).append(f))},deleteComment:function(a){a.preventDefault(a);var c=b(a.target);b.ajax({url:"/comments/comment/"+c.attr("rel"),type:"PATCH",data:{comment:gettext("-- Comment Removed --"),is_removed:!0},dataType:"json",success:function(){b("#comment"+c.attr("rel")).find("main").html(gettext("-- User Deleted Comment ---"))},error:function(a){b.growl(a.data,"error")}})},replyToComment:function(a){a.preventDefault(a);var d=this,e=b(a.target);console.log(this),d.$commentForm===c&&(d.$commentForm=d.$el.find(".commentsCommentFormWrapper")),d.$commentDiv!==c&&(d.$commentDiv.find(".commentsCommentFormWrapper").remove(),d.$commentDiv=c),d.$commentDiv=b("#"+e.attr("ref")),d.$commentDiv.find(".commentsCommentFormInlineHolder").append(d.$commentForm.clone()),d.$commentDiv.find("#commentsCommentForm").append('<input type="hidden" name="parent" value="'+e.attr("rel")+'">')}}),a.ShapeView=Backbone.View.extend({tagName:"tr",events:{"click .remove":"removethis","click .manage":"managethis",mouseenter:"hoverin",mouseleave:"hoverout","mouseenter .shapeformat":"showextraformatinfo","mouseleave .shapeformat":"removeextraformatinfo"},initialize:function(){this.template=_.template(b("#cntmo_prtl_mediaitem_format_tmpl").html()),_.bindAll(this,"render"),this.model.bind("change",this.render),this.model.view=this,this.$cnxtualMenu=""},hoverin:function(){this.$el.find(".hidden").fadeIn(250)},hoverout:function(){this.$el.find(".hidden").fadeOut(50)},showextraformatinfo:function(){var a=this.model.get("mimetype");if(-1!=a.indexOf("image")||-1!=a.indexOf("video")||-1!=a.indexOf("audio")||-1!=a.indexOf("application/mxf")){var b=this.$el.offset(),c=this.$cnxtualMenu.parent("td").offset(),d=c.left-b.left-16+"px",e=c.top-b.top-20+"px";this.$cnxtualMenu.addClass("cnxtualMenu-show"),this.$cnxtualMenu.css({left:d,top:e})}},removeextraformatinfo:function(){this.$cnxtualMenu.removeClass("cnxtualMenu-show")},removethis:function(a){a.preventDefault(a);var b=confirm(gettext("Are you sure you want to delete?"));b&&this.model.clear()},managethis:function(a){a.preventDefault(a),this.popup=new cntmo.prtl.views.ShapeManage({el:a})},render:function(){return this.$el.html(this.template(this.model.toJSON())),"iPad"===navigator.platform||"iPhone"===navigator.platform||"iPod"===navigator.platform?displayLength=10:this.$el.find(".hidden").removeClass("hidden"),this.$cnxtualMenu=this.$el.find(".cnxtualMenu"),this.$cnxtualMenu_arrow=this.$el.find(".cnxtualMenu_arrow"),this.$panelFormat=document.querySelector("#panel_format"),this}}),a.HistoryView=Backbone.View.extend({tagName:"tr",initialize:function(){this.template=_.template(b("#cntmo_prtl_mediaitem_history_tmpl").html()),_.bindAll(this,"render"),this.model.bind("change",this.render),this.model.view=this},render:function(){return this.$el.html(this.template(this.model.toJSON())),"iPad"===navigator.platform||"iPhone"===navigator.platform||"iPod"===navigator.platform?displayLength=10:this.$el.find(".hidden").removeClass("hidden"),this}}),a.ACLView=Backbone.View.extend({tagName:"tr",events:{"click .remove":"removethis",mouseenter:"hoverin",mouseleave:"hoverout"},hoverin:function(){this.$el.find(".hidden").fadeIn(250)},hoverout:function(){this.$el.find(".hidden").fadeOut(50)},removethis:function(a){a.preventDefault(),this.model.clear()},initialize:function(){this.template=_.template(b("#cntmo_prtl_mediaitem_acl_tmpl").html()),_.bindAll(this,"render"),this.model.bind("change",this.render),this.model.view=this},render:function(){return this.$el.html(this.template(this.model.toJSON())),"iPad"===navigator.platform||"iPhone"===navigator.platform||"iPod"===navigator.platform?displayLength=10:this.$el.find(".hidden").removeClass("hidden"),this}})}(cntmo.prtl.Item=cntmo.prtl.Item||{},jQuery);var mediabinUI=function(){$("div#mediabin").height()<1?$.cookie("cntmo_mediabin")?$("div#mediabin").height("160px"):($("div#mediabin").animate({height:"160px"},250,"easeOutBounce"),$.cookie("cntmo_mediabin","open",{expires:7,path:"/"})):($("div#mediabin").animate({height:"0px"},250,"swing"),$.cookie("cntmo_mediabin","open",{expires:-1,path:"/"}))};!function(a){a.MediaBinCollection=Backbone.Collection.extend({model:cntmo.vs.VSItem,url:"/mediabin/",parse:function(a){return a},initialize:function(){},comparator:function(a){return a.get("order")},getSelected:function(){return this.filter(function(a){return a.get("ui_selected")})},getSelectedorAll:function(){return 0===this.getSelected().length?this.models:this.getSelected()},isInBin:function(a){return _.include(this.pluck("resource_id"),a)}})}(cntmo.prtl.MediaBin=cntmo.prtl.MediaBin||{},jQuery),!function(){}(cntmo.prtl.MediaBin=cntmo.prtl.MedinBin||{},jQuery),!function(a,b,c){a.MediaBinVSItemView=Backbone.View.extend({tagName:"div",className:"smallmediapod mdl-shadow--2dp",events:{click:"clickHandler",dragstop:"dragHandler","click .cntmo_prtl_mediabin-pod-rmv":"removeItem","cntmo.prtl.MediaBinVSItemView.addContextPlugin":"addContextPlugin"},initialize:function(a){this.model=a.model,this.template=a.template,this.ui_select=!a.ui_select||a.ui_select,_.bindAll(this,"render","clickHandler"),this.model.bind("change",this.render),this.model.view=this,this.viewplugin={}},clickHandler:function(a){this.trigger("click",a,this.model),this.toggleSelected(a)},dragHandler:function(a){this.trigger("dragstop",a,this.model)},render:function(){this.$el.html(this.template(this.model.toJSON())),this.model.get("ui_selected")?this.$el.addClass("smallmediapod-selected"):this.$el.removeClass("smallmediapod-selected");try{this.$el.draggable({distance:20,revert:"invalid",stack:".mediabinitems div",helper:"clone",zIndex:12e3,appendTo:".mdl-layout__container"})}catch(a){}return b(this.el).data("backbone-view",this),this},toggleSelected:function(){var a=this;this.ui_select&&a.model.toggle()},removeItem:function(a){a.preventDefault(),this.model.destroy(),this.model.view.remove()},addContextPlugin:function(a,b,c,d){this.viewplugin[b]={callBackEvent:c,label:d},this.render()},remove:function(){this.$el.zoom()},removeView:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)}}),a.MainView=Backbone.View.extend({el:b("div#mediabin"),id:"mediabin",tagName:"div",className:"smallgriditem",events:{"click #cntmo_prtl_mediabin_dlt_lnk":"deleteSelected","click #cntmo_prtl_mediabin_rmv_lnk":"removeSelected","click #cntmo_prtl_mediabin_unselect_lnk":"unSelect","click #cntmo_prtl_mediabin_srt_date":"sortByID","click #cntmo_prtl_mediabin_srt_name":"sortByName","click #cntmo_prtl_mediabin_clct_lnk":"addToCollection","click #cntmo_prtl_mediabin_export_lnk":"export",drop:"dropped",dropactivate:"dropactivate",dropdeactivate:"dropdeactivate"},initialize:function(a){this.mediabinitems=[],this.mediabinitems_obj=this.$el.find(".mediabinitems"),this.countTemplate=a.countTemplate,this.attributes=a,this.collection=this.attributes.collection,this.spaceSearchResults=document.createElement("div"),_.bindAll(this,"addOne","addAll","render","errorHandler","updateUISize","deleteEvent","toggle","noevent","showOne","raiseEvent","dropped","dropactivate","dropdeactivate","updateCount"),this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll),this.collection.bind("resize",this.updateUISize),this.collection.bind("reset",this.render),this.collection.bind("all",this.updateCount),this.collection.bind("error",this.errorHandler),this.collection.bind("remove",this.updateUISize),this.collection.bind("remove",this.addAll),this.collection.bind("toggle",this.toggle),this.collection.bind("finishedAdding",this.noevent),this.collection.view=this,this.collection.fetch({reset:!0}),b.cookie("cntmo_mediabin")&&this.show(),b(document).bind("keydown","alt+b",this.toggle),b.subscribe("/cntmo/prtl/item/delete",this.deleteEvent),b.publish("/cntmo/prtl/MediaBin/ready")},noevent:function(){},raiseEvent:function(a,b,c){this.trigger(a,b,c)},errorHandler:function(){b.growl("error trying to make request","error")},addAll:function(){_.each(this.mediabinitems,function(a){a.removeView()}),this.mediabinitems=[],this.mediabinitems_obj.html(""),this.collection.each(this.showOne),b("#mediabin").trigger("cntmo.prtl.MediaBinView.Event.addAll")},showOne:function(d){var e=this;e.attributes.itemtemplate===c&&(e.attributes.itemtemplate=_.template(b("#cntmo_prtl_mediabin-pod-tmpl").html()));var f=new a.MediaBinVSItemView({model:d,template:e.attributes.itemtemplate,ui_select:e.attributes.ui_item_select});f.on("click",function(a,b){e.raiseEvent("view.click",a,b)}),f.on("dragstop",function(a,b){e.raiseEvent("view.dragstop",a,b)}),this.mediabinitems.push(f),this.mediabinitems_obj.append(f.render().el)},dropactivate:function(){b('<div class="smallmediapodDroppableTarget animated pulse"></div>').hide().appendTo(this.mediabinitems_obj).fadeTo(300,.7)},dropdeactivate:function(){this.mediabinitems_obj.find(".smallmediapodDroppableTarget").fadeOut(300,function(){b(this).remove()})},dropped:function(a,d){var e,f=this,g=b(d.draggable),h="",i=[];this.mediabinitems_obj.find(".smallmediapodDroppableTarget").remove(),i=g.data("selectedIDs")!==c?g.data("selectedIDs"):[g.attr("id")],_.each(i,function(a){""!==a&&(h=b("#"+a),e=h.find(".mediaitemtitle a").html()||a,f.collection.isInBin(a)===!1?f.collection.create({resource_id:a,resource_name:h.find(".mdl-card__title .mdl-card__title-text").html(),thumbnail_uri:h.find("img.mediathumb").attr("src"),parent_id:h.data("parentitem"),resource_type:h.data("itemtype")},{error:function(){b.growl(e+" "+gettext("could not be added"),"error")}}):b.growl(e+" "+gettext("is already in MediaBin"),"error"))})},addOne:function(a){this.showOne(a),this.updateUISize()},updateCount:function(){document.querySelector("#mediabin-tab-show .ntfcnttxt").textContent=this.collection.models.length;var a=document.querySelector("#mediabincount"),c=this.collection.getSelectedorAll().length;c+=1==this.collection.getSelectedorAll().length?" Item":" Items",this.collection.getSelected().length&&(c+=" Selected"),a.textContent=c;var d=document.querySelector("#cntmo_prtl_mediabin_unselect_lnk");d.textContent=this.collection.getSelected().length<1?"Select All":"Deselect All",this.collection.length<1?(b("#mediabin_cntx_menu").hide(),b("#mediabin_sort_menu").hide()):(b("#mediabin_cntx_menu").show(),b("#mediabin_sort_menu").show())},render:function(){this.updateUISize(),this.trigger("rendered"),this.$el.droppable({tolerance:"pointer",accept:".mediaitem"}),this.$el.find(".viewport").selectable("destroy").selectable({delay:100,distance:10,filter:".smallmediapod",selected:function(a,c){b(c.selected).click()}})},deleteEvent:function(a){var b,c=this;b=this.collection.where({resource_id:a}),c.collection.remove(b)},deleteSelected:function(){},removeSelected:function(a){return a.preventDefault(),_.each(this.collection.getSelectedorAll(),function(a){a.clear()}),!0},unSelect:function(a){a.preventDefault(),_.each(this.collection.getSelectedorAll(),function(a){a.toggle()})},addToCollection:function(a){var b;a.preventDefault(),b=_.map(this.collection.getSelectedorAll(),function(a){return a.get("resource_id")}),$LAB.script(cntmo.loadLocations.smartSelectBox).script(cntmo.loadLocations.addToCollection).wait(function(){new cntmo.prtl.Collection.addToCollection({selected_objects:b,library_selected:c,ignore_list:[]})})},export:function(a){var c,d=this,e=new Array,f="",g={};a.preventDefault(),_.each(this.collection.getSelectedorAll(),function(a){"SubClip"!==a.attributes.resource_type&&e.push(a.attributes.resource_id)}),e.length>0&&(b.each(e,function(a,b){f+="selected_objects="+b+"&"}),c=b("#cntmo_prtl_mediabin_export_lnk").attr("href")+"?"+f),g={width:600,modal:!0,resizable:!1,dialogClass:"exportView",title:gettext("Export"),show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},buttons:[{text:gettext("Export"),click:function(){b("#export_ajax_form").submit(),b(".ui-dialog-content").dialog("close").remove()},class:"send-export-button ui-dialog-button-confirm"},{text:gettext("Close"),click:function(){b(this).dialog("close"),b(".ui-dialog-content").dialog("close").remove()},class:"cancel-export-button ui-dialog-button-cancel"}]},d.$dialogEl=b("<div></div>"),d.$dialogEl.load(c).dialog(g)},sortByID:function(a){a&&a.preventDefault(),this.collection.comparator=function(a){return a.get("id")},this.collection.sort(),this.addAll()},sortByName:function(a){a&&a.preventDefault(),this.collection.comparator=function(a){return a.get("resource_name")},this.collection.sort(),this.addAll()},show:function(){this.$el.removeAttr("style"),this.updateUISize(),document.querySelector("#content").appendChild(this.spaceSearchResults),b.cookie("cntmo_mediabin","open",{expires:7,path:"/"})},hide:function(){this.$el.css("display","none"),document.querySelector("#content").removeChild(this.spaceSearchResults),b.cookie("cntmo_mediabin","open",{expires:-1,path:"/"})},toggle:function(){"none"==this.$el[0].style.display?this.show():this.hide()},updateUISize:function(){this.spaceSearchResults.style.height=this.$el.outerHeight()+"px"}})}(cntmo.prtl.MediaBin=cntmo.prtl.MediaBin||{},jQuery),!function(a,b){a.Retina={init:function(){var a=window.devicePixelRatio?window.devicePixelRatio:1;a>1&&b("img").each(function(a,c){c=b(c),c.attr("data-src2x")&&(c.attr("data-src-orig",c.attr("src")),c.attr("src",c.attr("data-src2x")))})}}}(cntmo.utils=cntmo.utils||{},jQuery),$("document").ready(function(){$.subscribe("/cntmo/prtl/MediaBin/finishedAdding",function(){var a,b,c=8,d=1,e=1;if(0===cntmo.app.page.mediaBinItems.view.$el.height()&&(a=document.createElement("canvas"),a.getContext)){b=a.getContext("2d"),$(a).attr("width",100).attr("height",100).attr("id","test_can").css("position","absolute").css("top","-25px").css("left","-25px"),$(a).prependTo("#mediabin-tab-show .ntfwrap"),b.beginPath(),b.arc(35,30,5,0,2*Math.PI,!0),b.strokeStyle="rgba(65, 131, 196, 0.5)",b.stroke(),onTimer=function(a){a.clearRect(0,0,100,100),a.arc(35,30,5+d,0,2*Math.PI,!0),e-=.1,style="rgba(65, 131, 196, "+e.toPrecision(1)+")",a.lineWidth=c,a.strokeStyle=style,a.stroke(),c+=1,d+=1,20==c&&($("#test_can").remove(),clearInterval(f))};var f=setInterval(onTimer,40,b)}}),window.flashElement=function(a){var b,c=1,d=1;$el=$(a),onTimer=function(){$el.css("box-shadow","0px 0px "+d+"px "+d+"px rgba(255, 0, 0, 0.5)"),c>3?c%3===0&&(d+=1):d+=1,c+=1,9==c&&($el.css("box-shadow","initial"),clearInterval(e))};var e=setInterval(onTimer,40,b)}}),$(document).ready(function(){if(gblPrtlIsAuthenticated){var a='<div class="fld_help_txt_arrow">';$("#metadataform","#main").delegate("li","mouseenter mouseleave",function(b){var c=$(this).find("div.fld_help_txt");"mouseenter"==b.type?$(c).siblings(".error").length<2&&(c.append(a),c.delay(250).addClass("fld_help_txt_show").animate({opacity:1},250)):c.css("opacity","0").removeClass("fld_help_txt_show").find(".fld_help_txt_arrow").remove()}).delegate("input, select, textarea","focusin focusout",function(b){var c=$(this).parent("li").find("div.fld_help_txt");"focusin"==b.type?$(this).hasClass("error")||(c.append(a),c.addClass("fld_help_txt_show").animate({opacity:1},250)):c.css("opacity","0").removeClass("fld_help_txt_show").find(".fld_help_txt_arrow").remove()}),window.$LAB&&$LAB.script(gblStaticURL+"mdl/js/app/mediabin/collection.js").wait().script(gblStaticURL+"mdl/js/app/mediabin/views.js").wait(function(){cntmo.app.page.mediaBinItems=new cntmo.prtl.MediaBin.MediaBinCollection,window.MediaBinItems=cntmo.app.page.mediaBinItems,!cntmo.app.page.mediaBin&&$("#cntmo_prtl_mediabin_cnt_tmpl").length>0&&(cntmo.app.page.mediaBin=new cntmo.prtl.MediaBin.MainView({countTemplate:_.template($("#cntmo_prtl_mediabin_cnt_tmpl").html()),collection:cntmo.app.page.mediaBinItems}),cntmo.prtl.MediaBinApp=cntmo.app.page.mediaBin),$("div.mediabin-tab").click(function(){cntmo.app.page.mediaBin.toggle()})})}try{languageCode=$("html").attr("lang")}catch(a){languageCode="en"}"en"!=languageCode&&$.tools.dateinput.localize(languageCode,{months:gettext("January,February,March,April,May,June,July,August,September,October,November,December"),shortMonths:gettext("jan,feb,mar,apr,may,jun,jul,aug,sep,oct,nov,dec"),days:gettext("Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday"),shortDays:gettext("sun,mon,tue,wed,thu,fri,sat")}),SHORT_DATE_FORMAT=formats.SHORT_DATE_FORMAT.replace("d","dd").replace("j","d").replace("l","d").replace("m","mm").replace("n","m").replace("N","M.").replace("b","M").replace("F","MM").replace("Y","yy"),$("ul.level-one").supersubs({hoverClass:"sfHover",minWidth:12,maxWidth:29,extraWidth:1}).superfish({speed:"fast"}),$("ul.plevel-one").supersubs({hoverClass:"sfHover",minWidth:8,maxWidth:29,extraWidth:1}).superfish({speed:"fast"}),$(".successmessage","#main").click(function(){$(this).fadeOut()}),$(".notice","#main").click(function(){$(this).fadeOut()}),$(".errormessage","#main").click(function(){$(this).fadeOut()}),$(document).bind("keydown","alt+u",unfocusUI),$(document).bind("keydown","alt+f",focusSearch),cntmo.utils.Retina.init(),$("#header .mediacontextualmenu").hover(function(){void 0!==cntmo.app.timers.mediacontextmenu&&clearTimeout(cntmo.app.timers.mediacontextmenu),$(this).addClass("mediacontextualmenu-hover").find("#mcm-dropdown").show()},function(){var a=this;cntmo.app.timers.mediacontextmenu=setTimeout(function(){$(a).removeClass("mediacontextualmenu-hover").find("#mcm-dropdown").hide()},800)})}),!function(a){var b=function(a){var b;for(b in cntmo.prtl.panelviews)cntmo.prtl.panelviews.hasOwnProperty(b)&&(_.include(a.viewopen,b)||_.include(a.norender,b)||cntmo.prtl.panelviews[b].hide(250));for(b in cntmo.prtl.panelviews)cntmo.prtl.panelviews.hasOwnProperty(b)&&_.include(a.viewopen,b)&&(_.include(a.norender,b)?cntmo.prtl.panelviews[b].show(250,!1):cntmo.prtl.panelviews[b].show(250))};a.fn.panelMgr=function(c){return this.each(function(){var d=a(this),e=JSON.parse(d.attr("rel"));try{e.callfunc?cntmo.prtl.executeFunctionByName(e,window,e.callfunc.args,b):b(e)}catch(a){alert(a)}try{a(c.contextMenu).find(".selected").removeClass("selected"),a(c.el).toggleClass("selected")}catch(a){alert(a)}})}}(jQuery),function(a){a.executeFunctionByName=function(a,b,c,d){for(var e=a.callfunc.func,f=Array.prototype.slice.call(arguments).splice(2)[0],g=e.split("."),h=g.pop(),i=0;i<g.length;i++)b=b[g[i]];try{"function"==typeof b[h]&&b[h].apply(window[f[0]],Array.prototype.slice.call(f).splice(1))}catch(a){}finally{return"function"==typeof d&&d(a),!1}}}(cntmo.prtl=cntmo.prtl||{},jQuery),!function(a){a.SearchSelectedCollection=Backbone.Collection.extend({model:cntmo.vs.VSItem}),a.SearchunSelectedCollection=Backbone.Collection.extend({model:cntmo.vs.VSItem}),a.PodPreviewCollection=Backbone.Collection.extend({model:cntmo.vs.VSItem}),a.SearchCollection=Backbone.Collection.extend({model:cntmo.vs.VSItem,url:"/API/v1/item/search/",page:1,current_page:0,total_count:0,initialize:function(){this.current_page=0,this.first_on_page=0,this.has_other_pages=!1,this.has_next=!1,this.has_previous=!1,this.last_on_page=!1,this.next=0,this.pages=0,this.pagination_amount=0,this.previous=0,this.total_count=0},parse:function(a){return this.current_page=a.meta.current_page,this.first_on_page=a.meta.first_on_page,this.has_other_pages=a.meta.has_other_pages,this.has_next=a.meta.has_next,this.has_previous=a.meta.has_previous,this.last_on_page=a.meta.last_on_page,this.next=a.meta.next,this.pages=a.meta.pages,this.pagination_amount=a.meta.pagination_amount,this.previous=a.meta.previous,this.total_count=a.meta.total_count,a.objects}})}(cntmo.prtl.Search=cntmo.prtl.Search||{},jQuery),cntmo.prtl.Search.Model=Backbone.Model.extend({}),!function(a,b,c){cntmo.prtl.Search={parseSearchString:function(a){return a},setupSearchResultsView:function(a){b(".infocheckbox").prop("checked",!1),a.searchquery!==c&&b.each("{{ searchquery }}".split(" "),function(a,c){b(".mediaitemtitle").highlight(c)})},SearchResultsView:Backbone.View.extend({tagName:"div",events:{"click .disabled a":"disableHandler","click #show_advanced":"hideShowSearchAdvancedEvent","click a.viewtypebutton":"viewTypeChange","click #exportitem":"exportItems","click #deleteitems":"deleteItems","click #search_metadata_batch_update":"metadataBatchUpdate","click #addtocollection":"addToCollection","click #transcodeitems":"transcodeItems","click #aclview":"aclView","click #selectallitems":"selectAllItems","click #selectallresults":"selectAllResults","click #selectallcurrentpage":"selectAllCurrentPage","click #deselectallcurrentpage":"deselectAllCurrentPage","click #restoreitems":"restoreItems","click a#savesearch":"saveSearch","click .mediacontextualmenu #addtobinitems":"addToBin","click .mediacontextualmenu #archive_selected_items":"archiveItems","click .mediacontextualmenu #restore_selected_items":"restoreItemsFromArchive","submit #searchform":"searchQuery","click div.annotationtimeline":"showPodPreviewEventHandler","click a.pod_preview":"showPodPreviewEventHandler","click a.archive_item":"archiveItemEventHandler","click a.restore_item":"restoreItemEventHandler","click .display_podType":"setupIntervalType","click .sortselector":"changeSortDirection","click a.copy_title":"copyTitleToClipboard","change select.airdate":"changeSortField","updatecount .mediaitem":"mediaItemChange"},initialize:function(a){_.bindAll(this,"startDraggable","selectAllItems","deselectSelectAll","changeSelectedLabels","selectPrevious","selectNext","mediaItemChange","enableAndDisableMenus","disableHandler","getItemPreviewInformation","buildPodPreview","bindAudioKeyBindings","unBindAudioKeyBindings","showPreview","showPodPreviewEventHandler","archiveItemEventHandler","restoreItemEventHandler","setupIntervalType","cacheDOMElements"),this.views={},this.options=a||{},this.search_adv_open=a.search_adv_open,this.search_adv_tog=a.search_adv_tog,this.library=a.library,this.library_selected=a.library_selected||c,this.search_id=a.search_id||c,this.search_id_selected=a.search_id_selected||c,this.is_collection=a.is_collection||!1,this.is_savedsearch=a.is_savedsearch||!1,this.delete_template=_.template(a.delete_template.html()),this.delete_library_confirm_template=_.template(a.deleteLibraryConfirm.html()),this.message_strings=a.message_strings,this.collection=new cntmo.prtl.Search.SearchCollection,this.selected_collection=new cntmo.prtl.Search.SearchSelectedCollection,this.ignore_list=new cntmo.prtl.Search.SearchunSelectedCollection,this.preview_list=new cntmo.prtl.Search.PodPreviewCollection,this.preview_currentitem=c,this.preview_error=!1,cntmo.prtl.Search.setupSearchResultsView({searchquery:a.searchquery||""}),this.cacheDOMElements(),this.bindKeyBindings(),this.startSelectable(),this.startDraggable(),this.$el.find("ul.plevel-one").superfish("destroy").superfish({speed:"fast"}),a.search_adv_tog,this.enableAndDisableMenus()},cacheDOMElements:function(){this.$firstvalEl=b("#first_on_page"),this.$lastvalEl=b("#last_on_page"),this.$hitstotalEl=b("#hits_total_results"),this.$viewtypebuttons=this.$el.find("a.viewtypebutton")},bindKeyBindings:function(){return b(document).bind("keydown","ctrl+a",this.deselectSelectAll),b(document).bind("keydown","shift+left",this.selectPrevious),b(document).bind("keydown","shift+right",this.selectNext),b(document).bind("keydown","left",this.selectPrevious),b(document).bind("keydown","right",this.selectNext),b(document).bind("keydown","space",this.showPodPreviewEventHandler),!0},unBindKeyBindings:function(){return b(document).off("keydown",this.deselectSelectAll),b(document).off("keydown",this.selectPrevious),b(document).off("keydown",this.selectNext),b(document).off("keydown",this.selectPrevious),b(document).off("keydown",this.selectNext),b(document).off("keydown",this.showPodPreviewEventHandler),!0},bindAudioKeyBindings:function(){return b(document).bind("keydown","space",this.playpauseaudio),!0},unBindAudioKeyBindings:function(){return b(document).off("keydown",this.playpauseaudio),!0},playpauseaudio:function(a){a.preventDefault(),a.stopImmediatePropagation(),cntmo.app.players.audioPlayer!==c&&(cntmo.app.players.audioPlayer.paused?cntmo.app.players.audioPlayer.play():cntmo.app.players.audioPlayer.pause())},disableHandler:function(a){return a.preventDefault(),a.stopImmediatePropagation(),!1},selectPrevious:function(a){a.shiftKey||deselectAllItems();var d;if(cntmo.app.page.lastMediaItemClicked!==c){var e=b("#"+cntmo.app.page.lastMediaItemClicked);d=e.prev(".mediaitem"),d.click()}else d=this.$el.find(".mediaitem:last"),d.click(),cntmo.app.page.lastMediaItemClicked=d.attr("id");d.isOnScreen("allOfIt")||b("html,body").animate({scrollTop:d.offset().top})},selectNext:function(a){a.shiftKey||deselectAllItems();var d;if(cntmo.app.page.lastMediaItemClicked!==c){var e=b("#"+cntmo.app.page.lastMediaItemClicked);d=e.next(".mediaitem"),d.click()}else d=this.$el.find(".mediaitem:first"),d.click(),cntmo.app.page.lastMediaItemClicked=d.attr("id");d.isOnScreen("allOfIt")||b("html,body").animate({scrollTop:d.offset().top})},startSelectable:function(){this.$el.find("#content").selectable("destroy").mousedown(function(a){return a.ctrlKey?(a.stopImmediatePropagation(),!1):void 0}).selectable({delay:100,distance:10,filter:".mediaitem",selected:function(a,c){b(c.selected).click()}})},startDraggable:function(){var a=this;this.$el.find(".mediaitem").draggable("destroy").mousedown(function(a){return a.ctrlKey?(a.stopImmediatePropagation(),!1):void 0}).draggable({appendTo:".mdl-layout__container",delay:100,filter:".mediaitem",helper:function(){var c=document.createElement("div"),d=document.createElement("div");d.classList.add("smallmediapod");var e=[];a.selected_collection.length?a.selected_collection.forEach(function(a){e.push(document.getElementById(a.get("id")))}):e.push(this);var f=0,g=0,h=12500;return e.forEach(function(a){var b=a.querySelector("img.mediathumb"),c=b?b.src:"/sitemedia/img/collection_group.png";c=document.createTextNode(c).data;var e=document.createElement("div");e.classList.add("media-pod-wrap"),e.style.backgroundImage="url('"+c+"')",e.style.top=f+"px",e.style.left=g+"px",e.style.zIndex=h,f+=30,g+=15,h--;var i=document.createElement("div");i.classList.add("mediaitemtitle");var j=a.querySelector(".mdl-card__title-text");i.textContent=j?j.textContent:"<no title>",e.appendChild(i),d.appendChild(e)}),c.appendChild(d),b(c)},start:function(){a.getSelectedItemIds(!0).length>1&&b(this).data({selectedIDs:a.getSelectedItemIds(!0)})},revert:!0,zIndex:12e3,distance:25,revertDuration:50})},deselectSelectAll:function(){this.library_selected=c,this.search_id_selected=c,this.$el.find(".selectedLibraryLabelChanges").each(function(a,b){self.changeSelectedLabels(b,!1)}),this.ignore_list.reset(),deselectAllItems(event),selectAllItems(event)},selectAllCurrentPage:function(a){a.preventDefault(),selectAllUnselectedItems(a)},deselectAllCurrentPage:function(a){a.preventDefault(),deselectAllItems()},selectAllItems:function(a){var b=this;return a.preventDefault(),this.selected_collection&&0==this.selected_collection.length?selectAllItems(a):(this.library_selected=c,this.search_id_selected=c,this.$el.find(".selectedLibraryLabelChanges").each(function(a,c){b.changeSelectedLabels(c,!0)}),this.ignore_list.reset(),deselectAllItems(a),this.selected_collection.reset(),this.labelsSelectedChange(),this.updateCount()),
!1},selectAllResults:function(a){var d=this;return a.preventDefault(),!b(a.target).hasClass("disabled")&&(this.library_selected!==c||this.search_id_selected!==c?(this.library_selected=c,this.search_id_selected=c,deselectAllItems(a),this.$el.find(".selectedLibraryLabelChanges").each(function(a,b){d.changeSelectedLabels(b,!1)}),this.ignore_list.reset([]),this.selected_collection.reset([]),this.search_id_selected=c,this.library_selected=c):(0!==this.selected_collection.length&&deselectAllItems(a),selectAllItems(a),this.$el.find(".selectedLibraryLabelChanges").each(function(a,b){d.changeSelectedLabels(b,!0)}),this.ignore_list.reset([]),this.selected_collection.reset([]),this.search_id?this.search_id_selected=this.search_id:this.library_selected=this.library),this.labelsSelectedChange(),this.updateCount(),!1)},getSelectedItemIds:function(a){return ids=_.pluck(this.selected_collection.reject(function(b){return!a&&"SubClip"==b.get("resource_type")}),"id")},getIgnoredItemIds:function(){return this.ignore_list.pluck("id")},changeSelectedLabels:function(a,b){a.textContent=b?"check_box_outline_blank":"select_all",a.nextElementSibling.textContent=b?a.getAttribute("deselectresultslabel"):a.getAttribute("selectresultslabel")},changeSortDirection:function(a){var c;c=this.options.searchcollections?"collectionsortdirection":"itemsortdirection";var d;return d=b(a.target).hasClass("ascending")?"descending":"ascending",this.is_savedsearch?void(window.document.location=updateQueryStringParameter(window.location.href,"sortdirection",d)):(b.cookie(c,d,{path:"/"}),this.searchQuery(a))},changeSortField:function(a){var c;c=this.options.searchcollections?"collectionsortfield":"itemsortfield";var d=b(a.target).val();return this.is_savedsearch?void(window.document.location=updateQueryStringParameter(window.location.href,"sortfield",d)):(b.cookie(c,d,{path:"/"}),this.searchQuery(a))},searchFormSubmit:function(){return(!window.history||!history.pushState)&&(b("#searchinputbutton").on("click",function(){b("#searchform input").each(function(){var a=this.name;if(""===b(this).val()){var c=a.match("_0$");if(c){var d=c.index,e=a.slice(0,d),f=b('input[name="'+e+'_1"]').val();"date"!==f&&"timestamp"!==f&&b(this).parent().remove()}}})}),void b(this).ajaxSubmit({beforeSubmit:function(){b("#loading-icon").fadeIn(500)},success:function(){b("#loading-icon").fadeOut(300)}}))},searchQuery:function(a){var d=this;if(b(a.currentTarget).find("span").hasClass("paginatorbutton-disabled")===!0)return!1;if(d.options.sfoptions==c)return!0;try{delete sfoptions.url}catch(a){}cntmo.app.page.searchresults.library_selected=c,cntmo.app.page.searchresults.search_id_selected=c,cntmo.app.page.searchresults.ignore_list.reset(),cntmo.app.page.searchresults.selected_collection.reset(),cntmo.app.page.searchresults.search_adv_open&&cntmo.app.page.searchresults.hideShowSearchAdvanced(b("#show_advanced")),cntmo.app.page.lastMediaItemClicked=c;var e=b(a.currentTarget).attr("href");this.options.sfoptions.url=e,a.preventDefault();try{b(a.currentTarget).attr("href")?history.pushState(null,null,b(a.currentTarget).attr("href")):history.pushState(null,null,"?"+b("#searchform").serialize())}catch(a){}d.$viewtypebuttons.each(function(){b(this).attr("href",window.location)}),b("<form/>").ajaxSubmit(d.options.sfoptions)},restoreItems:function(a){var d,e,f=this;a.preventDefault(),this.selected_collection.length>0?d=confirm(this.message_strings.restoreConfirm):(d=confirm(this.message_strings.restoreLibraryConfirm),d&&this.library_selected==c&&(this.library_selected=this.library)),d&&(e={selected_objects:this.getSelectedItemIds(!0),library_selected:this.library_selected,ignore_list:this.getIgnoredItemIds()},b.ajax({type:"POST",url:f.options.definedurls.restore_items_url,data:e,traditional:!0,success:function(a){var d=[];f.library_selected?d=f.getSelectedItemsOnCurrentPage():f.selected_collection.each(function(){d=f.selected_collection.toArray()}),b(d).each(function(a,c){if(!f.ignore_list.findWhere({id:c.id})){b.publish("/cntmo/prtl/item/restore",[c.id,"restore"]),f.$el.find("#"+c.id).fadeOut("slow",function(){b(this).remove(),f.updateCount()});try{lastval=parseInt(f.$lastvalEl.html(),10),hits_total_results=parseInt(f.$hitstotalEl.html(),10),f.$hitstotalEl.html(hits_total_results-1),f.$lastvalEl.html(lastval-1)}catch(a){}}}),f.selected_collection.reset([]),f.ignore_list.reset([]),f.library_selected=c,b.growl(a.success,"success")},error:function(){b.growl(f.message_strings.restoreError,"error")}}))},saveSearch:function(a){a.preventDefault();var c=this,d=b(a.target)||b(a.srcElement),e={width:600,modal:!0,resizable:!1,dialogClass:"savesearch",title:d.html(),buttons:[{text:gettext("Save"),click:function(){b("#savedsearch_add_form").submit()},class:"save-savesearch ui-dialog-button-confirm"},{text:gettext("Cancel"),click:function(){b(".ui-dialog-content").dialog("close").remove()},class:"cancel-savesearch ui-dialog-button-cancel"}]};c.$dialogEl=b("<div></div>"),c.$dialogEl.load(d.attr("href")).dialog(e)},deleteItems:function(a){var d,e=this;a.preventDefault(),d=this.selected_collection.length>0?e.selected_collection.length:e.$hitstotalEl.text()-e.ignore_list.length,standardOptions={width:600,modal:!0,resizable:!1,dialogClass:"savesearch",title:"Delete confirmation",buttons:[{text:gettext("Delete")+" "+d+" "+gettext("items"),click:function(){e.actualDelete()},class:"ui-dialog-button-confirm"},{text:gettext("Cancel"),click:function(){b(".ui-dialog-content").dialog("close").remove()},class:"ui-dialog-button-cancel"}]},e.$dialogEl=b("<div></div>");var f=e.getSelectedItemIds(),g={ids:f};if(this.library_selected!==c||this.search_id_selected!==c){var h=this.ignore_list.map(function(a){return a.id});g={ids:f,search_id:this.search_id,ignore_list:h}}b.ajax({type:"GET",url:e.options.definedurls.items_relation_url,data:g,traditional:!0,success:function(a){items_collections="undefined"!=typeof a.items_collections?a.items_collections:[],e.selected_collection.length>0?e.$dialogEl.html(e.delete_template({message:e.message_strings.deleteConfirm,items_collections:items_collections})).dialog(standardOptions):e.$dialogEl.html(e.delete_template({message:e.delete_library_confirm_template({selected_items_count:d}),items_collections:items_collections})).dialog(standardOptions)}})},metadataBatchUpdate:function(a){var c=this;a.preventDefault(),b.ajax({type:"GET",url:"/vs/metadatafieldgroups/",success:function(a){c.loadMetadataForm(a[0])},error:function(a){a.status>=400&&a.status<500?b.growl(a.responseText,"error"):b.growl(gettext("Failed to get metadata form"),"error")}})},renderMetadataForm:function(a){window.cntmo.prtl.Metadata.renderMetadataForm({id:"metadata-batch-popup",formClass:"formmain metadataform metadatabatchform",metadataGroupsUrl:"/vs/metadatafieldgroups/",metadataGroup:a,metadataUrlFn:function(a){return window.cntmo.app.Metadata.metadataGroup=a,"/API/v2/metadata-schema/groups/"+a+"/"},batch:!0,batchOptionsLegend:gettext("For all items check the box next to the field that you want to update by:")})},loadMetadataForm:function(a){var c=this,d=[];if(this.library_selected)d=this.getSelectedItemsOnCurrentPage();else{var c=this;this.selected_collection.each(function(){d=c.selected_collection.toArray()})}standardOptions={width:900,modal:!0,resizable:!1,dialogClass:"batchUpdateMetadata",title:gettext("Batch update metadata"),show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},buttons:[{text:gettext("Update"),click:function(){var a=window.cntmo.app.Metadata.FormComponent["metadata-batch-popup"],c="/search/batch_update_metadata/"+window.cntmo.app.Metadata.metadataGroup+"/?format=json";a.isValid?b.ajax({type:"POST",data:a.serialize(),url:c,success:function(a){"ok"==a.status&&b.growl(a.message,"success")},error:function(a){a.status>=400&&a.status<500?b.growl(a.responseText,"error"):b.growl(gettext("Failed to queue items for batch metadata update"),"error")}}):a.validate()},class:"send-export-button ui-dialog-button-confirm"},{text:gettext("Close"),click:function(){b(this).dialog("close"),b(".ui-dialog-content").dialog("close").remove()},class:"cancel-export-button ui-dialog-button-cancel"}]},c.$dialogEl&&c.$dialogEl.remove(),c.$dialogEl=b("<div></div>"),c.$dialogEl.html("<div id='metadata-batch-popup'></div>").dialog(standardOptions),c.renderMetadataForm(a)},archiveItems:function(a){a.preventDefault();var c=[];if(this.library_selected)c=this.getSelectedItemsOnCurrentPage();else{var d=this;this.selected_collection.each(function(){c=d.selected_collection.toArray()})}item_ids=[],b(c).each(function(a,b){item_ids.push(b.id)});var e={item_ids:item_ids};if(0===item_ids.length){var f=this.ignore_list.map(function(a){return a.id});e.search_id=this.search_id,e.ignore_list=f}b.ajax({type:"POST",data:JSON.stringify(e),url:"/archive_framework/items/archive/",success:function(){b.growl(gettext("Items queued for archival"),"success")},error:function(a){a.status>=400&&a.status<500?b.growl(a.responseText,"error"):b.growl(gettext("Failed to queue items for archival"),"error")}})},restoreItemsFromArchive:function(a){a.preventDefault();var c=[];if(this.library_selected)c=this.getSelectedItemsOnCurrentPage();else{var d=this;this.selected_collection.each(function(){c=d.selected_collection.toArray()})}item_ids=[],b(c).each(function(a,b){item_ids.push(b.id)});var e={item_ids:item_ids};if(0===item_ids.length){var f=this.ignore_list.map(function(a){return a.id});e.search_id=this.search_id,e.ignore_list=f}b.ajax({type:"POST",data:JSON.stringify(e),url:"/archive_framework/items/restore/",success:function(){b.growl(gettext("Items queued for restore"),"success")},error:function(a){a.status>=400&&a.status<500?b.growl(a.responseText,"error"):b.growl(gettext("Failed to queue items for restore"),"error")}})},actualDelete:function(){var a=this,d={selected_objects:this.getSelectedItemIds(!0),library_selected:this.library_selected,search_id_selected:this.search_id_selected,ignore_list:this.getIgnoredItemIds(),collection:this.is_collection};a.options.eager_delete!==c&&a.options.eager_delete===!0&&(d.eager_delete=!0),b.ajax({type:"POST",url:a.options.definedurls.delete_item_url,data:d,traditional:!0,success:function(d){var e=[];a.library_selected?e=a.getSelectedItemsOnCurrentPage():a.selected_collection.each(function(){e=a.selected_collection.toArray()}),b(e).each(function(c,d){if(!a.ignore_list.findWhere({id:d.id})){b.publish("/cntmo/prtl/item/delete",[d.id,"delete"]),a.$el.find("#"+d.id).fadeOut("slow",function(){b(this).remove(),a.updateCount()});try{lastval=parseInt(a.$lastvalEl.html(),10),hits_total_results=parseInt(a.$hitstotalEl.html(),10),a.$hitstotalEl.html(hits_total_results-1),a.$lastvalEl.html(lastval-1)}catch(a){}}}),a.selected_collection.reset([]),a.ignore_list.reset([]),a.library_selected=c,b.growl(d.success,"success")},error:function(){b.growl(a.message_strings.deleteError,"error")}}),b(".ui-dialog-content").dialog("close").remove()},exportItems:function(a){if(a.preventDefault(),!b(a.target).hasClass("disabled")){var c,d=this,e="",f={},g=d.getSelectedItemIds();g.length>0?(b.each(g,function(a,b){e+="selected_objects="+b+"&"}),c=this.options.definedurls.exporturl+"?"+e):c=this.options.definedurls.exportallurl,this.ignore_list.map(function(a){c+="&ignore_list="+a.id}),f={width:600,modal:!0,resizable:!1,dialogClass:"exportView",title:gettext("Export"),show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},buttons:[{text:gettext("Export"),click:function(){b("#export_ajax_form").submit(),b(".ui-dialog-content").dialog("close").remove()},class:"send-export-button ui-dialog-button-confirm"},{text:gettext("Close"),click:function(){b(this).dialog("close"),b(".ui-dialog-content").dialog("close").remove()},class:"cancel-export-button ui-dialog-button-cancel"}]},d.$dialogEl=b("<div></div>"),d.$dialogEl.load(c).dialog(f)}},addToBin:function(a){a&&a.preventDefault();var d,e=this,f=!0,g=[],h=e.getSelectedItemIds(!0);(e.library_selected!==c||e.search_id_selected!==c)&&(f=confirm(gettext("Adding an entire search result to the bin is not permitted. Do you want to add the highlighted items in the current page?")),h=e.$el.find("#searchresultswrapper").find(".mediaitem.mediaitem-selected").map(function(){return this.id}).get()),cntmo.app.page.mediaBinItems!==c&&f&&(0===h.length&&e.library_selected===c&&e.search_id_selected===c&&(e.selectAllItems(a),h=e.getSelectedItemIds(!0)),_.each(h,function(a){var b=e.$el.find("#"+a);if(cntmo.app.page.mediaBinItems.isInBin(b.attr("id"))===!1)try{cntmo.app.page.mediaBinItems.create({resource_id:b.attr("id"),resource_name:b.find(".mdl-card__title .mdl-card__title-text").html(),thumbnail_uri:b.find("img.mediathumb").attr("src"),resource_type:b.data("itemtype")},{error:function(){g.push(gettext("Could not add to bin item: ")+b.attr("id"))}})}catch(a){g.push(a)}else g.push(gettext("Item already in MediaBin"))}),g.length>0?_.each(g,function(a){d!=a&&(b.growl(a),d=a)}):(b.publish("/cntmo/prtl/MediaBin/finishedAdding"),b.growl(gettext("Added to MediaBin"),"success")))},aclView:function(a){a&&a.preventDefault(),standardOptions={width:600,modal:!0,resizable:!1,dialogClass:"aclView",title:gettext("Access Control List"),show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:[{text:gettext("Close"),click:function(){b(this).dialog("close")},class:"close-acl-button ui-dialog-button-confirm"}]},b("#acltable").dialog(standardOptions)},addToCollection:function(a){a&&a.preventDefault();var b,d=this,e=function(){0===d.getSelectedItemIds(!0).length&&d.library_selected===c&&d.search_id_selected==c?(d.selectAllItems(a),b=gettext("Add All to Collection")):b=d.library_selected!==c||d.search_id_selected!=c?gettext("Add All Results to Collection"):d.message_strings.collectionaddbutton||gettext("Add Selected Items to Collection"),d.views.addToCollectionView=new cntmo.prtl.Collection.addToCollection({collectionaddbuttontext:d.message_strings.collectionaddbutton||gettext("Add To Collection"),collectioncancelbuttontext:d.message_strings.collectioncancelbutton||gettext("Cancel"),title:b,selected_objects:d.getSelectedItemIds(!0),library_selected:d.library_selected,search_id_selected:d.search_id_selected,ignore_list:d.getIgnoredItemIds(),from_collection:d.options.is_collection})};$LAB.script(cntmo.loadLocations.addToCollection).wait(function(){e()})},transcodeItems:function(a){a.preventDefault();var d=this,e={width:600,modal:!0,resizable:!1,dialogClass:"transcodeView",title:gettext("Transcode Items"),show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},close:function(){b(this).dialog("destroy").remove()},buttons:[{text:gettext("Transcode"),click:function(){b("#transcodeformchooser").on("change",function(){b("#transcode_ajax_form").valid()});var a=c;cntmo.app.page.searchresults?(a=cntmo.app.page.searchresults,b("#selected_library").val(a.library_selected),b("#search_id_selected").val(a.search_id_selected)):cntmo.app.page.collectionitemresults&&(a=cntmo.app.page.collectionitemresults,b("#selected_collection").val(a.library_selected)),b("#selected_items").val(a.getSelectedItemIds().join()),b("#ignored_items").val(a.getIgnoredItemIds().join()),b("#transcode_ajax_form").ajaxForm({dataType:"json",beforeSubmit:function(){return!!b("#transcode_ajax_form").valid()},success:function(a,c){"success"==c&&(b.growl(a,"success"),b(".ui-dialog-content").dialog("close"))},error:function(a){b.growl(a,"error"),b("#vscollectionexport").empty().end(),b(".ui-dialog-content").dialog("close")}}),b("#transcode_ajax_form").submit()},class:"send-transcode-button ui-dialog-button-confirm"},{text:gettext("Cancel"),click:function(){b(".ui-dialog-content").dialog("close")},class:"cancel-transcode-button ui-dialog-button-cancel"}]};d.$dialogEl=b("<div></div>"),d.$dialogEl.load(b(a.currentTarget).attr("rel")).dialog(e)},hideShowSearchAdvancedEvent:function(a){var c=b(a.target)||b(a.srcElement),d=this;d.hideShowSearchAdvanced(c)},hideShowSearchAdvanced:function(a){var b=a.attr("beforeText"),c=a.attr("afterText");this.search_adv_open===!0?(this.$el.find(".sa_placeholder").hide(),a.html(b),this.search_adv_open=!1):(this.search_adv_tog!==!0,this.$el.find(".sa_placeholder").show(),this.search_adv_open=!0,a.html(c))},viewTypeChange:function(a){return a.preventDefault(),b.cookie("search_results_viewtype",b(a.target).attr("refs"),{path:"/"}),this.searchQuery(a)},mediaItemChange:function(a){var d=this,e=a.target.id,f=b(a.target).attr("data-itemtype"),g=!1;this.getSelectedItemsOnCurrentPage().filter("#"+e).length>0&&(g=!0),this.library_selected!==c||this.search_id_selected!==c?(g?this.ignore_list.remove({id:e}):this.ignore_list.add({id:e,resource_type:f}),this.ignore_list.length===parseInt(this.$hitstotalEl.html(),10)&&(this.ignore_list.reset([]),this.selected_collection.reset([]),this.search_id_selected=c,this.library_selected=c,this.$el.find(".selectedLibraryLabelChanges").each(function(a,c){b(c).html(b(c).attr("noLibrarySelectedStateLabel"))}))):g?(this.ignore_list.get(e)&&this.ignore_list.remove(e),d.selected_collection.get(e)||this.selected_collection.add({id:e,resource_type:f})):this.selected_collection.remove(e),this.labelsSelectedChange(),this.updateCount()},updateCount:function(){var a=this;a.library_selected!==c||a.search_id_selected!==c?a.$el.find(".selectioncount").html(a.ignore_list.length>0?gettext("All except")+" "+a.ignore_list.length:a.$hitstotalEl.text()):a.selected_collection.length>0?a.$el.find(".selectioncount").html(a.selected_collection.length):(a.$el.find(".selectioncount").html(""),a.$el.find("#selectionmsg").html(a.$el.find("#selectionmsg").attr("noitemsselectedstatelabel"))),this.enableAndDisableMenus()},labelsSelectedChange:function(){var a=this.$el.find(".selectedStateLabelChanges");this.selected_collection.length>0||this.library_selected!==c||this.search_id_selected!==c?b.each(a,function(a,c){b(c).html(b(c).attr("itemsselectedstatelabel"))}):b.each(a,function(a,c){b(c).html(b(c).attr("noitemsselectedstatelabel"))})},enableAndDisableMenus:function(){var a=!1,b=!1,d=!1,e=this.getSelectedItemsOnCurrentPage(),f=this.getAllItemsOnCurrentPage();if((this.library_selected!==c||this.search_id_selected!==c)&&(a=!0),this.selected_collection.length>0&&(a=!0),e.length>0&&(a=!0,d=!0),e.length<f.length&&(b=!0),a?this.$el.find(".actions").removeClass("disabled"):this.$el.find(".actions").addClass("disabled"),b?this.$el.find("#selectallcurrentpage").removeClass("disabled"):this.$el.find("#selectallcurrentpage").addClass("disabled"),d?this.$el.find("#deselectallcurrentpage").removeClass("disabled"):this.$el.find("#deselectallcurrentpage").addClass("disabled"),f.length>0){this.$el.find("#selectallresults").removeClass("disabled");var g=this.$el.find("#exportitem");g.data("areas-available")&&g.removeClass("disabled")}else this.$el.find("#selectallresults").addClass("disabled"),this.$el.find("#exportitem").addClass("disabled")},getAllItemsOnCurrentPage:function(){return this.$el.find(".mediaitem")},getSelectedItemsOnCurrentPage:function(){return this.$el.find(".mediaitem.mediaitem-selected")},parseNewPage:function(){var a=this;this.library_selected!==c||this.search_id_selected!==c?this.$el.find(".mediaitem").each(function(c,d){a.ignore_list.findWhere({id:d.id})||(a.selected_collection.remove(a.selected_collection.get(d.id)),b(d).click())}):this.selected_collection.length>0&&this.$el.find(".mediaitem").each(function(c,d){a.selected_collection.findWhere({id:d.id})&&(a.selected_collection.remove(a.selected_collection.get(d.id)),b(d).click())}),this.startDraggable(),this.updateCount()},showPodPreviewEventHandler:function(a){var d,e,f,g,h,i=this;a&&(a.preventDefault(),a.stopPropagation());var j=c;if(cntmo.app.page.searchresults!==c?j=cntmo.app.page.searchresults:cntmo.app.page.collectionitemresults!==c&&(j=cntmo.app.page.collectionitemresults),a&&a.currentTarget.hasAttribute!==c&&a.currentTarget.hasAttribute("data-podpreviewurl"))e=b(a.currentTarget).attr("data-podpreviewurl"),"SubClip"===b(a.target).attr("data-itemtype")?(e+="?SubClip="+b(a.target).attr("id"),d=b(a.currentTarget).attr("data-parentitem")):d=b(a.currentTarget).attr("rel"),f=b(a.currentTarget).attr("title"),g=b(a.currentTarget).attr("data-relstarttimecode"),h=b(a.currentTarget).attr("data-relendtimecode");else if(j&&j.selected_collection&&j.selected_collection.length>0)item=j.selected_collection.last(),itemDomObject=b("#"+item.get("id")+".mediaitem"),e=itemDomObject.attr("data-podpreviewurl"),"SubClip"===item.get("resource_type")?d=itemDomObject.attr("data-parentitem"):(d=item.get("id"),e+="?SubClip"),f=itemDomObject.find(".mediaitemtitle a").text(),g=itemDomObject.attr("data-relstarttimecode"),h=itemDomObject.attr("data-relendtimecode");else if(this.$el.find(".mediaitem.mediaitemsubclip.mediaitem-selected").length>0)d=b(this.$el.find(".mediaitem.mediaitemsubclip.mediaitem-selected")[0]).attr("data-parentitem"),f=b(this.$el.find(".mediaitem.mediaitemsubclip.mediaitem-selected")[0]).find(".mediaitemtitle a").text(),e=b(this.$el.find(".mediaitem.mediaitemsubclip.mediaitem-selected")[0]).attr("data-podpreviewurl")+"?SubClip=",e+=b(this.$el.find(".mediaitem.mediaitemsubclip.mediaitem-selected")[0]).attr("id"),g=b(this.$el.find(".mediaitem.mediaitemsubclip.mediaitem-selected")[0]).attr("data-relstarttimecode"),h=b(this.$el.find(".mediaitem.mediaitemsubclip.mediaitem-selected")[0]).attr("data-relendtimecode");else{if(a.currentTarget.hasAttribute===c||!a.currentTarget.hasAttribute("data-podpreviewurl"))return!1;d=b(a.currentTarget).attr("data-parentitem"),f=b(a.currentTarget).attr("data-title"),e=b(a.currentTarget).attr("data-podpreviewurl")+"?SubClip=",e+=b(a.currentTarget).attr("id"),g=b(a.currentTarget).attr("data-relstarttimecode"),h=b(a.currentTarget).attr("data-relendtimecode")}return i.getItemPreviewInformation(d,g,h),i.buildPodPreview(d,e,f),!0},archiveItemEventHandler:function(a){a&&a.preventDefault();var c=a.target.attributes.getNamedItem("ref").value;b.ajax({type:"POST",url:"/archive_framework/"+c+"/archive/",success:function(){b.growl(gettext("Item queued for archival"),"success")},error:function(a){409==a.status?b.growl(gettext("Archive plugin might not be configured"),"error"):410==a.status?b.growl(gettext("No archive plugin found"),"error"):b.growl(gettext("Failed to queue item for archival"),"error")}})},restoreItemEventHandler:function(a){a&&a.preventDefault();var c=a.target.attributes.getNamedItem("ref").value;b.ajax({type:"POST",url:"/archive_framework/"+c+"/restore/",success:function(){b.growl(gettext("Item queued for restore"),"success")},error:function(a){409==a.status?b.growl(gettext("Archive plugin might not be configured"),"error"):410==a.status?b.growl(gettext("No archive plugin found"),"error"):b.growl(gettext("Failed to queue item for restore"),"error")}})},buildPodPreview:function(a,d,e){var f=this;if(f.canusepreview===c){var g=document.createElement("video");f.canusepreview=g.canPlayType!==c}f.canusepreview?$LAB.script(cntmo.loadLocations.captionator).script(cntmo.loadLocations.player).wait(function(){b.ajax({url:d,success:function(a){f.podPreview=b('<div class="podPreview">').html(a).dialog({modal:!0,title:e,draggable:!1,resizable:!1,position:{my:"center",at:"center",of:window},width:"75vw",dialogClass:"ui-dialog-podpreview",open:function(a){b(".ui-dialog-content").css("display","flex"),b(".podPreview footer").css("display","none"),b(".ui-widget-overlay").addClass("ui-widget-overlay-podpreview").on("click",function(){f.podPreview.dialog("close")}),f.unBindKeyBindings(),f.showPreview(),b(a.target).parent().find(".ui-dialog-title").on("click",function(){window.location.href="/vs/item/"+f.preview_currentitem.get("id")+"/"}),componentHandler.upgradeDom()},beforeClose:function(){if(cntmo.app.players.mainPlayer!==c)try{cntmo.app.players.mainPlayer.pause(),cntmo.app.players.mainPlayer.timeline.timeline.length>0&&_.each(cntmo.app.players.mainPlayer.timeline.timeline,function(){cntmo.app.players.mainPlayer.removeFromTimeline(0)})}catch(a){}finally{cntmo.app.players.mainPlayer.disableHotkeys()}return b("#player").hide().insertBefore("#mediabin"),b(".podPreviewImage").remove(),f.bindKeyBindings(),f.unBindAudioKeyBindings(),b("body").css({overflow:"inherit"}),!0},create:function(){b("body").css({overflow:"hidden"})},close:function(){f.preview_error=!1,f.preview_currentitem=c,f.podPreview!==c&&f.podPreview.remove(),delete f.podPreview}})},error:function(){b.growl(gettext("Could not open preview"),"error")}})}):b.growl(gettext("Please upgrade your browser"),"error")},getItemPreviewInformation:function(a,d,e){var f=this,g=new cntmo.vs.VSItem({resource_uri:f.options.definedurls.item_api+a+"/"});return $LAB.script(cntmo.loadLocations.player).wait(function(){g.fetch({success:function(){d!==c&&e!==c&&(startTC=new Timecode({smpte:d}),endTC=new Timecode({smpte:e}),mediaStartTC=g.get("start_tc"),duration=endTC.minus(startTC),g.set({start_tc:d,duration:duration.toSMPTE(),mediaStartTC:mediaStartTC})),"sequence"===g.get("resource_type")&&f.getSequenceInformation(g),f.preview_currentitem=g},error:function(){b.growl(gettext("Error getting item information"),"error"),f.preview_error=!0}})}),!0},getSequenceInformation:function(a){var c=this,d=Backbone.Collection.extend({model:cntmo.vs.VSItem,url:c.options.definedurls.sequence_api+a.get("id")+"/",parse:function(a){return a.sequence_elements}}),e=new d;return e.fetch({success:function(){e.done=!0,e.each(function(a){b.ajax({url:c.options.definedurls.item_api+a.get("id")+"/",success:function(b){a.set({browse_urls:b.browse_urls})}})})}}),a.set({collection:e}),!0},showPreview:function(){var a,d,e,f=this,g=c;if(f.preview_currentitem!==c&&b("#playerwrapper").length>0){var h=function(a){return g=-1!==navigator.userAgent.search("Firefox")?_.find(a.get("browse_urls"),function(a){return"video/webm"==a.file_type}):_.find(a.get("browse_urls"),function(a){return"video/mp4"==a.file_type}),g!==c?g.url:c};if("video"==f.preview_currentitem.get("resource_type"))h(f.preview_currentitem)!==c?(f.setOrGetPreviewPlayer(),cntmo.app.players.mainPlayer.addToTimeline(0,{url:h(f.preview_currentitem),startTC:f.preview_currentitem.get("start_tc"),mediaStartTC:f.preview_currentitem.get("mediaStartTC")||f.preview_currentitem.get("start_tc"),frameRateNumerator:f.preview_currentitem.get("framerate_numerator"),frameRateDenominator:f.preview_currentitem.get("framerate_denominator"),durationTC:f.preview_currentitem.get("duration")}),cntmo.app.players.mainPlayer.setTimelineStartTC(f.preview_currentitem.get("start_tc")),b("#player").appendTo("#playerwrapper").show(),cntmo.app.players.mainPlayer.enableHotkeys(),cntmo.app.players.mainPlayer.play()):b.growl(gettext("Could not find a proper file to show preview"),"error");else if("audio"==f.preview_currentitem.get("resource_type")){g=_.find(f.preview_currentitem.get("browse_urls"),function(a){return"audio/mpeg"==a.file_type});var i=b('<div class="player"><div class="audioplayer" id="audioplayerwrapper" style="width:635px;height:432px;"><audio style="height:432px;width:635px" id="audioplayer" class="player" controls></div></div>');i.appendTo("#playerwrapper"),cntmo.app.players.audioPlayer=document.getElementById("audioplayer"),cntmo.app.players.audioPlayer.src=g.url,cntmo.app.players.audioPlayer.play(),null!==f.preview_currentitem.get("representative_thumbnail")&&b("#audioplayerwrapper").css({"background-image":"url("+f.preview_currentitem.get("representative_thumbnail")+")"}),f.bindAudioKeyBindings()}else if("image"==f.preview_currentitem.get("resource_type"))if(g=_.find(f.preview_currentitem.get("browse_urls"),function(a){return"image/jpeg"==a.file_type}),f.podPreview&&f.podPreview.find(".podPreviewImage").length>0)f.podPreview.find(".podPreviewImage").attr({src:g.url});else{var j=b('<img src="'+g.url+'" class="podPreviewImage">');j.appendTo("section.preview")}else if("sequence"==f.preview_currentitem.get("resource_type"))if(f.setOrGetPreviewPlayer(),f.preview_currentitem.get("collection").done!==!0)setTimeout(f.showPreview,50);else{var k=f.preview_currentitem.get("collection").length;f.preview_currentitem.get("collection").at(k-1).has("browse_urls")===!1?setTimeout(f.showPreview,50):f.preview_currentitem.get("collection").each(function(c,g,i){a=Timecode({smpte:c.get("inpoint"),fps:c.get("fps")}),d=Timecode({smpte:c.get("outpoint"),fps:c.get("fps")}),e=d.minus(a),cntmo.app.players.mainPlayer.addToTimeline(g,{url:h(c),startTC:a.toSMPTE(),mediaStartTC:a.toSMPTE(),durationTC:e.toSMPTE()}),i.length-1===g&&(cntmo.app.players.mainPlayer.setTimelineStartTC(f.preview_currentitem.get("start_tc")),b("#player").appendTo("#playerwrapper").show(),cntmo.app.players.mainPlayer.enableHotkeys(),cntmo.app.players.mainPlayer.play(),cntmo.app.players.mainPlayer.setCurrentTC(f.preview_currentitem.get("start_tc")))})}else b.growl(gettext("Could not find a proper file to show preview"),"error")}else f.preview_error===!1&&setTimeout(f.showPreview,50)},setOrGetPreviewPlayer:function(){if(cntmo.app.players.mainPlayer===c){var a=b('<div id="player" class="player">');a.appendTo("#playerwrapper"),cntmo.app.players.mainPlayer=new PleroVideoPlayer(a,{dimensionClass:"largePlayer",hotkeys:!0,timeline:[],startTC:"00:00:00:00",onerror:function(a){b.growl(gettext("There was an error starting the viewerplayer: ")+a,"error")}}),b(cntmo.app.players.mainPlayer).off().on("timeline:canplay",function(){cntmo.app.players.mainPlayer.play()})}else cntmo.app.players.mainPlayer.timeline.timeline.length>0&&_.each(cntmo.app.players.mainPlayer.timeline.timeline,function(a,b){cntmo.app.players.mainPlayer.removeFromTimeline(b)});return!0},setupIntervalType:function(){return!0},copyTitleToClipboard:function(a){var c=a.target.getAttribute("name"),d=function(a){a.clipboardData.setData("text/plain",c),a.preventDefault()};document.addEventListener("copy",d),document.execCommand("copy"),document.removeEventListener("copy",d),b.growl("Title copied to clipboard.","success")}})}}(cntmo.prtl=cntmo.prtl||{},jQuery),!function(a){function b(b){var c=document.getElementById("growlDock");return c&&!b||(c=a("<div></div").attr("id","growlDock").addClass("growl"),a("body").append(c)),a(c)}function c(){if(!document.querySelector("#growl-style")){var a=document.createElement("style");a.id="growl-style";var b=" #growlDock { position: fixed; top: 56px; right: 10px; z-index: 11000; } #growlDock > div { display: flex; align-content: stretch; align-items: center; justify-content: space-between; background-color: #fff; margin-bottom: 10px; border-radius: 2px; box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 1px 5px 0 rgba(0, 0, 0, 0.12); max-width: 300px; } #growlDock .growl-message { flex-grow: 1; border-top-left-radius: 2px; border-bottom-left-radius: 2px; padding: 10px; } #growlDock .growl-message.error { background-color: rgb(244, 67, 54); color: #fff; } #growlDock .growl-message.success { background-color: rgb(139, 195, 74); color: #fff; } #growlDock .close { cursor: pointer; padding: 0 10px; }";a.type="text/css",a.appendChild(document.createTextNode(b)),document.head.appendChild(a)}}function d(a,b){var c=document.createElement("div");return c.innerHTML='<div class="alert growl-message" role="alert"></div><i class="close material-icons">close</i>',a=document.createTextNode(a),c.firstElementChild.appendChild(a),c.firstElementChild.classList.add(b),c}function e(e,f,g){var h=b();c();var i=d(e,f),j=a(i).hide().fadeIn().css("display","flex"),k=a(i).find(".close");if(k.click(function(){j.remove()}),a.growl.settings.noticeDisplay(j),h.append(j),!g)var l=window.setTimeout(function(){jQuery.growl.settings.noticeRemove(j,l,function(){j.remove()})},3e3)}a.growl=function(a,b,c){e(a,b,c)},a.growl.version="1.1.0",a.growl.settings={noticeDisplay:function(a){a.css({opacity:"0"}).fadeIn(jQuery.growl.settings.noticeFadeTimeout)},noticeRemove:function(a,b,c){a.animate({opacity:"0",height:"0px"},{duration:jQuery.growl.settings.noticeFadeTimeout,complete:c}),b&&window.clearTimeout(b)},noticeFadeTimeout:"slow"}}(jQuery);var observeDOM=function(){var a=window.MutationObserver||window.WebKitMutationObserver,b=window.addEventListener;
return function(c,d){if(a){var e=new a(function(a,b){(a[0].addedNodes.length||a[0].removedNodes.length)&&d()});e.observe(c,{childList:!0,subtree:!0})}else b?(c.addEventListener("DOMNodeInserted",d,!1),c.addEventListener("DOMNodeRemoved",d,!1)):console.log("Something went wrong in observeDOM. No 'MutationObserver' or 'addEventListener'.")}}();window.addEventListener("DOMContentLoaded",function(){addMdlToMenuItems(".mdl-menu a:not(.mdl-menu__item)")}),window.addEventListener("load",function(){var a=document.getElementById("react-search-form");return!!a&&(modSearchButton(a),modAdvancedSearchButton(a),void observeDOM(document.querySelector(".searchform"),function(){console.log(".searchform dom changed");var b=a.querySelectorAll(".searchcritera ul li.choice_wrapper .field_container");if(b.length)for(var c=0;c<b.length;c++){var d=b.item(c);"LABEL"==d.tagName&&d.classList.contains("mdl-radio")||(d=cloneNodeDiffTag(d,"label"),d.classList.add("mdl-radio","mdl-js-radio","mdl-js-ripple-effect"),d.setAttribute("for",d.firstElementChild.id));for(var e=0;e<d.children.length;e++){var f=d.children.item(e);"LABEL"==f.tagName&&(f=cloneNodeDiffTag(f,"span"),f.classList.add("mdl-radio__label")),"INPUT"==f.tagName&&f.classList.add("mdl-radio__button")}componentHandler.upgradeElement(d)}}))});
{% load i18n cache navbar %}
{% comment %}
    We have two methods of defining the navigation - either through the admin menu, and from the database or
    hard coding it.
    {% if request.user %}{% subtree navtree %}{% endif %}
{% endcomment %}
{% spaceless %}

{% if user.is_authenticated %}

{% url homepage as homepage %}
{% url vs_upload as vs_upload %}
{% url search:index as search %}
{% url search:advanced as advanced_search %}
{% url vs_saved_searches as vs_saved_searches %}
{% url vs_collections as vs_collections %}
{% url vs_storages as vs_storages %}
{% url vs_users_all as vs_users_all %}
{% url vs_user_add as vs_user_add %}
{% url vs_group_add as vs_group_add %}
{% url vs_groups_all as vs_groups_all %}
{% url vs_jobs as vs_jobs %}
{% url vs_indexes as vs_indexes %}
{% url admin_logreport as admin_logreport %}
{% url vs_item_new as vs_item_new %}
{% url vs_metadata_management as vs_metadata_management %}
{% url vs_search_last as vs_search_last %}
{% url themes as themes %}
{% url vs_export_locations as vs_export_locations %}
{% url vs_shape_tags as vs_shape_tags %}
{% url metadata_element_groups as metadata_element_groups %}
{% url vs_storage_item_simple as vs_storage_item_simple %}
{% url projects:index as cntmo_projects %}
{% url admin_index as admin_index %}
{% url system_index as system_index %}
{% url recyclebin as recyclebin %}
{% url sharing:admin as sharingadmin %}



<nav class="navbar navbar-default navbar-static-top" id="topNav">
    <div class="container-fluid">
        <div class="navbar-header">
        <a class="navbar-brand" href="{% url homepage %}" {% current_nav homepage %} title="{% trans "Home" %}">Ubiquity</a>
        <button data-target="#topNavCollapse" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="navbar-collapse collapse navbar-responsive-collapse" id="topNavCollapse">
            <ul class="nav navbar-nav">
                <li class="dropdown" >
                    <a data-toggle="dropdown" class="dropdown-toggle"  href="{% url search:index %}">{% trans "Find" %} <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        {% permissionrequired _item_search %}
                        <li {% current_nav vs_search_last %}><a href="{% url vs_search_last 10 %}"  title="{% trans "Last 10 Items" %}">{% trans "Last 10 Items" %}</a></li>
                        <li {% current_nav search %} ><a href="{% url search:index %}" title="{% trans "Search All" %}">{% trans "Search All" %}</a></li>
                        <li {% current_nav advanced_search %}><a href="{% url search:advanced %}"  title="{% trans "Advanced Search" %}">{% trans "Advanced Search" %}</a></li>
                        {% endpermissionrequired %}
                        {% permissionrequired _collection_read %}
                        <li {% current_nav vs_saved_searches %}><a href="{% url vs_saved_searches %}"  title="{% trans "Saved Searches" %}">{% trans "Saved Searches" %}</a></li>
                        {% endpermissionrequired %}
                        {% pluginblock "NavigationFindPlugin" core %}
                    </ul>
                </li>
                
                {% permissionrequired _import %}
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="{% url vs_upload %}">{% trans "Ingest" %} <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li {% current_nav vs_upload %} ><a href="{% url vs_upload %}" title="{% trans "Upload" %}">{% trans "Upload" %}</a></li>
                        {% permissionrequired _storage_read %}
                        <li {% current_nav vs_storage_item_simple %}><a href="{% url vs_storage_item_simple %}"  title="{% trans "Import From Storage" %}">{% trans "Import From Storage" %}</a></li>
                        {% endpermissionrequired %}
                        <li {% current_nav vs_item_new %}> <a href="{% url vs_item_new %}"  title="{% trans "Create Placeholder" %}">{% trans "Create Placeholder" %}</a></li>
                        {% pluginblock "NavigationIngestPlugin" core %}
                    </ul>
                </li>
                 {% endpermissionrequired %}
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="{% url vs_upload %}">{% trans "Manage" %} <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        {% permissionrequired _collection_read %}
                        <li {% current_nav vs_collections %}><a href="{% url vs_collections %}"  title="{% trans "Collections" %}">{% trans "Collections" %}</a></li>
                        {% endpermissionrequired %}

                        {% permissionrequired _metadata_global_read %}
                        <li {% current_nav metadata_element_groups %}><a href="{% url metadata_element_groups %}" title="{% trans "Metadata Elements" %}">{% trans 'Metadata Elements' %}</a></li>
                        {% endpermissionrequired %}
                        {% permissionrequired _administrator %}
                        <li {% current_nav recyclebin  %}><a href="{% url recyclebin %}"  title="{% trans "items marked for deletion" %}">{% trans "Recycle Bin" %}</a></li>
                        {% endpermissionrequired %}
                        {% permissionrequired _administrator %}
                        <li {% current_nav sharingadmin  %}><a href="{% url sharing:admin %}"  title="{% trans "Sharing" %}">{% trans "Sharing" %}</a></li>
                        {% endpermissionrequired %}
                        {% pluginblock "NavigationManagePlugin" core %}
                    </ul>
                </li>
                
                {% if user|has_role:"_administrator" or user.is_staff %}
                <li class='dropdown'>
                    <a data-toggle="dropdown" class="dropdown-toggle"  href="{% url admin_index %}">{% trans "Admin" %} <b class="caret"></b></a>
                    <ul class='dropdown-menu'>
                        <li {% current_nav admin_index %}><a href="{% url admin_index %}"  title="{% trans "System Overview" %}">{% trans "System Overview" %}</a></li>
                        <li {% current_nav system_index %}><a href="{% url system_index %}" title="{% trans "System Settings" %}">{% trans "System Settings" %}</a></li>

                        {% if user|has_role:"_group_write" %}
                        <li><a href="{% url vs_users_all %}" {% current_nav vs_users_all %} title="{% trans "User and Groups Settings" %}">{% trans "Users and Groups" %}</a>
                            <ul class='dropdown-menu'>
                                <li><a href="{% url vs_users_all %}" {% current_nav vs_users_all %} title="">{% trans "All Users" %}</a></li>
                                <li><a href="{% url vs_user_add %}" {% current_nav vs_user_add %} title="{% trans "Add User" %}">{% trans "Add User" %}</a></li>
                                <li><a href="{% url vs_group_add %}" {% current_nav vs_group_add %} title="">{% trans "Add Group" %}</a></li>
                                <li><a href="{% url vs_groups_all %}" {% current_nav vs_groups_all %} title="">{% trans "All Groups" %}</a></li>
                            </ul>
                        </li>
                        {% endif %}
                        {% if user|has_role:"_metadata_field_group_write" and user|has_role:"_metadata_field_write" %}
                            <li><a href="{% url vs_metadata_management %}" {% current_nav vs_metadata_management %} title="{% trans "Metadata Management" %}" target="_blank">{% trans "Metadata Management" %}</a></li>
                        {% endif %}
                        <li><a href="{% url themes %}" {% current_nav themes %} title="{% trans "Themes" %}">{% trans "Themes" %}</a></li>
                        <li><a href="{% url vs_export_locations %}" {% current_nav vs_export_locations %} title="{% trans "Export Locations" %}">{% trans "Export Locations" %}</a></li>
                        {% if user|has_role:"_shape_tag_write" %}
                            <li><a href="{% url vs_shape_tags %}" {% current_nav vs_shape_tags %} title="{% trans "Transcode Profiles" %}">{% trans "Transcode Profiles" %}</a></li>
                        {% endif %}
                        {% if user|has_role:"_storage_write" and user|has_role:"_storage_group_write" %}
                            <li><a href="{% url vs_storages %}" {% current_nav vs_storages %} title="{% trans "Storages" %}">{% trans "Storages" %}</a></li>
                        {% endif %}
                        {% if user|has_role:"_job_read" %}
                            <li><a href="{% url vs_jobs %}" {% current_nav vs_jobs %} title="{% trans "Jobs" %}">{% trans "Jobs" %}</a></li>
                        {% endif %}
                        {% if user|has_role:"_administrator" %}
                            <li><a href="{% url vs_indexes %}" {% current_nav vs_indexes %} title="{% trans "Indexes" %}">{% trans "Indexes" %}</a></li>
                        {% endif %}
                        {% if user|has_role:"_administrator" %}
                            <li><a href="{% url admin_logreport %}" {% current_nav admin_logreport %} title="{% trans "Report Error" %}">{% trans "Report Error" %}</a></li>
                        {% endif %}
                        {% if user|has_role:"_administrator" %}
                           <li><a href="{% url admin:comments_comment_changelist %}" title="{% trans "Comments" %}"
                                {% if '/admin/comments/' in request.path %}
                                    class="selected"
                                {% endif %}>{% trans 'Comments' %}</a>
                            </li>
                        {% endif %}
                        {% pluginblock "NavigationAdminPlugin" core %}
                    </ul>
                </li>
                {% endif %}
            </ul>
            
            
            <div class="navbar-right">
                
                <form role="search" class="navbar-form navbar-left" action="{% url search:index %}" method="get">
                    {% csrf_token %}
                    <div class="input-group">
                        <div class="input-group-addon"><span class="mdi-action-search"></span> <span class="sr-only">{% trans "Search" %}:</span> </div>
                        <input type="search" autocomplete="no"  name="searchquery" value="{% if not searchquery == None %}{{ searchquery|escape  }}{% endif %}" class="searchfield form-control" id="searchtext"  accesskey="4" x-webkit-speech>
                    </div>
                </form>
                
                <ul class="nav navbar-nav navbar-left">
                    <li class='dropdown'>   
                        <a data-toggle="dropdown" class="dropdown-toggle"  href="{% url user_settings %}">
                            {% trans "You are logged in as" %} {{request.user.username}}
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu" role="menu">
                            <li role="presentation">
                                <a role="menuitem" tabindex="-1" href="{% url user_settings %}">Profile</a>
                            </li>
                            <li role="presentation" class="divider"></li>
                            <li role="presentation">
                                <a role="menuitem" tabindex="-1" href="/authentication/logout/">{% trans "Logout"%}</a>
                            </li>
                        </ul>
                    </li>
                </ul>
                
            </div>
           
        </div>
        
    </div>
</nav>
{% endif %}
{% endspaceless %}

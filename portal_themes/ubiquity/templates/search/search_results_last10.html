{% themeextends "search/base_search_results.html" %}
{% load i18n %}
{% block title %}{% trans "Search" %} {{ searchquery }}{% endblock title %}
{% block head %}
<link href="{% url vs_search_last_atom_feed 10 %}" type="application/atom+xml" rel="alternate" title="{% trans "Last 10 Atom Feed" %}" />{% endblock head %}
{% block heading %}
<div id="header" class="header">    

        <div class="mediacontextualmenu"><div class="tabholder"><span class="largecontextmenu">&nbsp;</span></div>
        <div id="mcm-dropdown" class="mcm-dropdown">
            <ol class="actions disabled">
                    <div>
                        <span id="selectionmsg" itemsSelectedStateLabel="{% trans "Selected Items:" %}" noItemsSelectedStateLabel="{% trans "No Items Selected" %}" class="selectedStateLabelChanges">{% trans "No Items Selected" %}</span>
                        <span class="selectioncount"> </span>
                    </div>
               {% if originalshape %}
                  <li><a id="exportitem" href="#">{% trans "Export" %}</a></li>
               {% endif %}
                <li><a href="#" rel="{% url vs_collection_add_form %}" id="addtocollection"> {% trans "Add to Collection" %}</a></li>
    <!--
                {% if library %}
                  <li><a href="{% url vs_saved_search_add_form library %}" id="savesearch">{% trans "Save Search" %}</li>
                {% endif %}
    -->
                {% permissionrequired _job_write %}
                <li><a href="#" rel="{% url vs_items_transcode %}" id="transcodeitems"> {% trans "Transcode" %}</a></li>
                {% endpermissionrequired %}

                {% permissionrequired _item_shape_write  %} 
                <li><a href="#" id="deleteitems">{% trans "Delete" %}</a></li>
                {% endpermissionrequired %} 
                {% pluginblock "Last10SearchViewDropdown" core %}
            </ol>
            <ol>
              <div>{% trans "Current page:" %}</div>
              <li><a href="" id="selectallcurrentpage" >{% trans "Select all" %}</a></li>
              <li><a href="" id="deselectallcurrentpage" class="disabled">{% trans "Deselect all" %}</a></li>
              {% pluginblock "RecycleBinViewGearBoxCurrentPage" core %}
            </ol>

        </div>
    {% comment %}
        <div id="swr-holder" class="swr-holder">
            <input type="checkbox" value={{ library }} name="searchwithinresults" id="searchwithinresults" />
            <label for="searchwithinresults">{% trans "Search within results" %}</label>
            <input type="checkbox" value="me" name="userchooser" id="userchooser" />
            <label for="userchooser">{% trans "Show only my content" %}</label>
        </div>
        <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            $("#swr-holder").hide();
            $("#searchoptionstoggle").click(function() {
                    $("#swr-holder").animate({height: "toggle"}, 100);
                $(this).text($(this).text() == '\u2193 {% trans "Options" %}' ? '\u2191 {% trans "Options" %}' : '\u2193 {% trans "Options" %}');
            });
        });
        </script>
    {% endcomment %}

    </div>
    
    <form action="{% url search:index %}" method="get" accept-charset="utf-8" class="searchresultsform">
        <div id="largesearchformwrapper">
            
            <div class="input-group input-group-lg">
                <input name="searchquery" type="text"  class="form-control "  placeholder="{% trans "Search" %}" id="searchinputfield" value="{% if not searchquery == None %}{{ searchquery|escape }}{% endif %}" autocomplete="off" role="textbox" autofocus>
                <div class="input-group-btn">
                 <button aria-expanded="false" class="btn btn-primary" type="submit">
                     <i class="glyphicon glyphicon-search"></i> <span class="sr-only">Search</span>
                 </button>
             </div>
            </div><!-- /input-group -->
        </div>
    </form>
    
    
</div><!-- #header -->


{% endblock heading %}

{% block content %}
	{% themeinclude "search/search_results_header.html" %}
    <div class="fullwidthcontent">
        {% if hits %}
            {% for item in items  %}
                {% url vs_item item.getId as item_URL  %}
                {% themeinclude 'media/media_inc_preview.html' %}
            {% endfor %}

            <div id="sr_load_more" class="sr_load_more"><p><a href="#sr_load_more" id="sr_load_more_lnk">{% trans "Load more results" %}</a></p></div>
        {% else %}
            <p>&nbsp;</p>
            <h2>{% trans "No media found." %}</h2>
            {% if searchquery == "" %}
                <p>{% blocktrans %}We couldn't find any media matching your search query, please try again.{% endblocktrans %}</p>
            {% else %}
                <p>{% blocktrans %}We couldn't find any media matching the query term "{{ searchquery }}", please try again.{% endblocktrans %}</p>
            {% endif %}
        {% endif %}
    </div><!-- .fullwidthcontent -->
    <div class="" style="width:100%;clear:both;height:1px;">&nbsp;</div>
    <div class="centerwrapper">

    </div><!-- .centerwrapper -->
{% endblock content %}


{% block inlinejs %}
<script type="text/javascript" charset="utf-8">
$(document).ready(function() {
    $('#searchform').center().submit(function(){
        $('#searchinputfield').autocomplete('close');
    });
    $('#searchinputfield').autocomplete({
        source: '{% url search:suggest %}'
    }).bind('autocompleteopen', function(event, ui){
        $(this).autocomplete('widget').addClass('searchinputfieldautocomplete');
    });
    $('.srpaneltoggle').hide();
    $('.srinfo').hide();
    var intPageNo = parseInt('{{ page }}',10)+1;
    var maxResults = parseInt('{{ hits }}',10);
    var noOfResults = parseInt('{{ items|length }}',10);
    var request_no_hits = parseInt('{{ request_no_hits }}',10);
    var resultsOnPage = noOfResults*intPageNo;
    var resultsLeft = maxResults-resultsOnPage;
    var intInterate = 0;
    var loadingGif = "<img src='{{ STATIC_URL }}img/{{ theme }}/icon-ajax-loader.gif' id='icon-ajax-loader' />";

    if (maxResults <= noOfResults) {
        $('.sr_load_more').hide();
    }
    $(".sr_load_more").click(function(){
        var urlStr = '/vs/searchlast/'+ request_no_hits + '/' + intPageNo +'/';
        if (resultsLeft > noOfResults) {
            intInterate = noOfResults;
        } else { 
            //var intInterate = resultsLeft;
            intInterate = noOfResults;
        }
        for (i=1;i<=intInterate;i++) {
            $(".sr_load_more").before("<div class='dynLPlaceHolders'>"+ loadingGif +"</div>");
        }
        $.ajax({
           url: urlStr,
           success: function(data) {
               $(".dynLPlaceHolders").remove();
               $('.sr_load_more').before(data);
               intPageNo +=1;
               resultsOnPage = noOfResults*intPageNo;
               resultsLeft = maxResults-resultsOnPage;
               $('.mediaitem').draggable('destroy')
                                .draggable({
                                    delay: 100,
                                    helper: 'clone',
                                    revert: true,
                                    zIndex: 100,
                                    distance: 25,
                                    revertDuration: 50
                                });
                $('ul.plevel-one').supersubs({
                    hoverClass:    'sfHover',
                    minWidth:    8,
                    maxWidth:    29,
                    extraWidth:  1
                }).superfish({
                    speed:       'fast'
                });
                try {
                    if (search_library_id != "") {
                        var newurl = "{% url vs_saved_search_add_form_no_library %}" + escape(search_library_id) + "/";
                        $('.mediacontextualmenu #savesearch').attr('href', newurl).show();
                    }
                } catch(err) {

                }
             cntmo.app.page.searchresults.updateCount();
           },
           complete: function(){
               if (resultsLeft <= 0) {
                  $(".sr_load_more").remove();
               }
            }
        });
    });
});
</script>
{% endblock inlinejs %}
{% docstring %}
search_results_last10.html is shown for retrieving the last 10 results from the system.

Context:
 * items - list of search result items.
 * hits - Amount of search results in total.
 * searchquery - search query in the system.
 * history - Search history
 * first_on_page - number from 0 of the first item on page
 * has_next - has a next page
 * has_other_pages - has other pages
 * last_on_page - last on page
 * library - Vidispine library ID
 * next - Next page number
 * page - Current page
 * pages - Total number of pages
 * results_per_page - Results to show on page.

PluginBlock:
 * Last10SearchViewDropdown - Inject into the dropdown menu for the complete saved search

{% enddocstring %}

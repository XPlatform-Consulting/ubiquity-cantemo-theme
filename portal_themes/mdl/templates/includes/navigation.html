{% comment %}
    We have two methods of defining the navigation - either through the admin menu, and from the database or
    hard coding it.
    {% if request.user %}{% subtree navtree %}{% endif %}
{% endcomment %}

{% load i18n cache navbar messages users %}

{% if user.is_authenticated %}

{% url homepage as homepage %}
{% url vs_upload as vs_upload %}
{% url search:index as search %}
{% url search:advanced as advanced_search %}
{% url vs_saved_searches as vs_saved_searches %}
{% url vs_collections as vs_collections %}
{% url vs_storages as vs_storages %}
{% url vs_users_all as vs_users_all %}
{% url vs_user_add as vs_user_add %}
{% url vs_group_add as vs_group_add %}
{% url vs_groups_all as vs_groups_all %}
{% url vs_jobs as vs_jobs %}
{% url vs_indexes as vs_indexes %}
{% url admin_logreport as admin_logreport %}
{% url vs_item_new as vs_item_new %}
{% url vs_metadata_management as vs_metadata_management %}
{% url vs_search_last as vs_search_last %}
{% url themes as themes %}
{% url vs_export_locations as vs_export_locations %}
{% url vs_shape_tags as vs_shape_tags %}
{% url metadata_element_groups as metadata_element_groups %}
{% url vs_storage_item_simple as vs_storage_item_simple %}
{% url projects:index as cntmo_projects %}
{% url admin_index as admin_index %}
{% url system_index as system_index %}
{% url recyclebin as recyclebin %}
{% url sharing:admin as sharingadmin %}
{% url dashboard:dashboard as dashboard %}
{% url archive_framework:jobs as archive_jobs %}



<header class="mdl-layout__header">
    <div aria-expanded="true" role="button" tabindex="0" class="mdl-layout__drawer-button"><i class="material-icons">î—’</i></div>    

    <div id="main-row" class="mdl-layout__header-row">
        
        <span class="mdl-layout-title" title="{% trans "Home" %}">Cantemo</span>



        <div class="cantemo-head-spacer"></div>

        {% comment %}
        TODO: add in the actual search functionality
        {% endcomment %}
        <form action="#" class="cantemo-search-bar">
            <div class="cantemo-search-input-container">
                <input id="cantemo-search-exp" placeholder="Search" class="cantemo-search-input" type="text">
            </div>
            <div class="cantemo-search-icon mdl-button--icon"><i class="material-icons">search</i></div>
        </form>

        {% if REALTIME_ENABLED %}
        <div>
            <a id="ntfcnt" class="{% if notice_unseen_count > 0 %}inboxpop{% else %}inboxempty{% endif %}" href="#">
                <div class="ntfwrap">
                    <div id="ntfcnttxt">
                        {% if notice_unseen_count > 0 %}
                        {{ notice_unseen_count }}
                        {% endif %}
                    </div>
                </div>
            </a>
        </div>
        {% endif %}

        <div id="notifications">
            <button class="cantemo-notifications-button mdl-button mdl-button--icon">
                {% if notice_unseen_count > 0 %}
                    <i class="material-icons">notifications</i>  
                {% else %}
                    <i class="material-icons">notifications_none</i>
                {% endif %}
            </button>
            <div class="cantemo-notifications-card-popup triangle"></div>
            <div class="cantemo-notifications-card-popup mdl-card mdl-shadow--2dp">
                {% for message in messages%}
                    {{message}}
                {% endfor %}

                {% if notice_unseen_count > 0 %}
                    <div class="mdl-card__supporting-text mdl-card--expand">
                        {{ notice_unseen_count }} Notifications
                        {{ request.user.messages}}
                    </div>
                {% else %}
                    <div class="cantemo-card-top">
                        {% trans "No Notifications" %}
                    </div>
                {% endif %}
            </div>  
        </div>
        <div id="account" class="">
            <button class="cantemo-nav-avatar cantemo-settings-button mdl-button mdl-button--icon">
                <div style="display:none">{% get_avatar_image user %}</div>
                {% if avatarurl %}
                    <img src="{{ avatarurl }}" alt="{{ avataruser }}" class="cantemo-nav-avatar user-avatar-image user-avatar-set">
                {% else %}
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" enable-background="new 0 0 {{ avatarwidth }} {{ avatarheight }}" xml:space="preserve" width="{{ avatarwidth }}px" height="{{ avatarheight }}px" class="cantemo-nav-avatar {% if avataruser %}user-avatar-userknown{% else %}user-avatar-userunknown{% endif %}">
                        <path {% if avataruser %} class="user-avatar-userknown" {% else %} class="user-avatar-userunknown" {% endif %} id="user-avatar-icon" d="M407.448,360.474c-59.036-13.617-113.989-25.541-87.375-75.717 c81.01-152.729,21.473-234.406-64.072-234.406c-87.231,0-145.303,84.812-64.072,234.406c27.412,50.482-29.608,62.393-87.375,75.717 c-59.012,13.609-54.473,44.723-54.473,101.176h411.838C461.919,405.196,466.458,374.083,407.448,360.474z"/> 
                    </svg>
                {% endif %} 
            </button>
            <div class="cantemo-settings-card-popup triangle"></div>
            <div class="cantemo-settings-card-popup mdl-card mdl-shadow--2dp">
                <div class="cantemo-card-top">
                    {% if avatarurl %}
                        <div class="navigation-account-img">    
                            <img src="{{ avatarurl }}" alt="{{ avataruser }}" class="cantemo-nav-avatar-lg user-avatar-image user-avatar-set">
                        </div>
                    {% else %}
                        <div class="navigation-account-img">    
                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" enable-background="new 0 0 {{ avatarwidth }} {{ avatarheight }}" xml:space="preserve" width="{{ avatarwidth }}" height="{{ avatarheight }}" class="user-avatar-image cantemo-nav-avatar-lg {% if avataruser %}user-avatar-userknown{% else %}user-avatar-userunknown{% endif %}">
                                <path {% if avataruser %} class="user-avatar-userknown" {% else %} class="user-avatar-userunknown" {% endif %} id="user-avatar-icon" d="M407.448,360.474c-59.036-13.617-113.989-25.541-87.375-75.717 c81.01-152.729,21.473-234.406-64.072-234.406c-87.231,0-145.303,84.812-64.072,234.406c27.412,50.482-29.608,62.393-87.375,75.717 c-59.012,13.609-54.473,44.723-54.473,101.176h411.838C461.919,405.196,466.458,374.083,407.448,360.474z"/> 
                            </svg>
                        </path>
                    {% endif %}

                    {% cache 500 navigationuserinfo request.user.username %}
                        <div class="navigation-account-info">
                            <user><b> {{ request.user.first_name|capfirst }}</b> <b>{{ request.user.last_name|capfirst }} </b></user>
                            <user-name>{{ request.user.username }}</span> </user-name>
                        </div>
                    {% endcache %}
                </div>

                <div class="mdl-card__actions mdl-card__supporting-text mdl-card--border">
                    {% if request.user.get_profile.organisation %}
                        <organization>{% trans "Organisation" %}: {{ request.user.get_profile.organisation }}</organization>
                    {% endif %}
                    <groups>
                        {% trans "Groups" %}: 
                        <span>
                        {% for g in user.groups.all  %}
                            {% if not g|stringformat:"s" == '_special_all' %}
                                {{ g }}
                            {% endif %}
                        {% endfor %}
                        </span>
                    </groups>
                </div>
                
                <div class="mdl-card__actions mdl-card--border">
                    <a class="mdl-button mdl-js-button mdl-button--primary" href="{% url user_settings %}">{% trans "Settings" %}</a>
                    <span class="mdl-layout-spacer"></span>
                    <a class="mdl-button mdl-js-button mdl-button--primary" href="/authentication/logout/">{% trans "Logout" %}</a>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="mdl-layout__drawer" aria-hidden="true">    
    <div class="leftcontent" id="mv_menu">
        <!-- {% includetheme "include/navigation_drawer.html" %} -->
    </div>
</div>
<div class="mdl-layout__obfuscator"></div>
<!-- mdl includes/navigation.html end -->
<!-- mdl includes/navigation.html start -->

{% endif %}
